!function(){var v={},m={},t={},b=window.document,p=window.RegExp,g=window.navigator,h=72,T={isIE:/msie/.test(g.userAgent.toLowerCase()),isIE_5or6:/msie 6/.test(g.userAgent.toLowerCase())||/msie 5/.test(g.userAgent.toLowerCase()),isOpera:/opera/.test(g.userAgent.toLowerCase())};function n(){}function d(e){this.buttonBar=b.getElementById("wmd-button-bar"+e),this.preview=b.getElementById("wmd-preview"+e),this.input=b.getElementById("wmd-input"+e)}function u(t,n){var r,o,i,a=this,s=[],l=0,c="none",d=function(e,t){c!=e&&(c=e,t||f()),T.isIE&&"moving"==c?i=null:o=setTimeout(u,1)},u=function(e){i=new w(n,e),o=void 0};this.setCommandMode=function(){c="command",f(),o=setTimeout(u,0)},this.canUndo=function(){return 1<l},this.canRedo=function(){return!!s[l+1]},this.undo=function(){a.canUndo()&&(r?(r.restore(),r=null):(s[l]=new w(n),s[--l].restore(),t&&t())),c="none",n.input.focus(),u()},this.redo=function(){a.canRedo()&&(s[++l].restore(),t&&t()),c="none",n.input.focus(),u()};var f=function(){var e=i||new w(n);if(!e)return!1;"moving"!=c?(r&&(s[l-1].text!=r.text&&(s[l++]=r),r=null),s[l++]=e,s[l+1]=null,t&&t()):r||(r=e)},p=function(e){var t=!1;if(e.ctrlKey||e.metaKey){var n=e.charCode||e.keyCode;switch(String.fromCharCode(n)){case"y":a.redo(),t=!0;break;case"z":e.shiftKey?a.redo():a.undo(),t=!0}}if(t)return e.preventDefault&&e.preventDefault(),void(window.event&&(window.event.returnValue=!1))},g=function(e){if(!e.ctrlKey&&!e.metaKey){var t=e.keyCode;33<=t&&t<=40||63232<=t&&t<=63235?d("moving"):8==t||46==t||127==t?d("deleting"):13==t?d("newlines"):27==t?d("escape"):(t<16||20<t)&&91!=t&&d("typing")}};!function(){v.addEvent(n.input,"keypress",function(e){!e.ctrlKey&&!e.metaKey||89!=e.keyCode&&90!=e.keyCode||e.preventDefault()});var e=function(){(T.isIE||i&&i.text!=n.input.value)&&null==o&&(c="paste",f(),u())};v.addEvent(n.input,"keydown",p),v.addEvent(n.input,"keydown",g),v.addEvent(n.input,"mousedown",function(){d("moving")}),n.input.onpaste=e,n.input.ondrop=e}(),u(!0),f()}function w(i,e){var a=this,s=i.input;this.init=function(){v.isVisible(s)&&(!e&&b.activeElement&&b.activeElement!==s||(this.setInputAreaSelectionStartEnd(),this.scrollTop=s.scrollTop,(!this.text&&s.selectionStart||0===s.selectionStart)&&(this.text=s.value)))},this.setInputAreaSelection=function(){if(v.isVisible(s))if(void 0===s.selectionStart||T.isOpera){if(b.selection){if(b.activeElement&&b.activeElement!==s)return;s.focus();var e=s.createTextRange();e.moveStart("character",-s.value.length),e.moveEnd("character",-s.value.length),e.moveEnd("character",a.end),e.moveStart("character",a.start),e.select()}}else s.focus(),s.selectionStart=a.start,s.selectionEnd=a.end,s.scrollTop=a.scrollTop},this.setInputAreaSelectionStartEnd=function(){if(i.ieCachedRange||!s.selectionStart&&0!==s.selectionStart){if(b.selection){a.text=v.fixEolChars(s.value);var e=i.ieCachedRange||b.selection.createRange(),t=v.fixEolChars(e.text),n=""+t+"";e.text=n;var r=v.fixEolChars(s.value);e.moveStart("character",-n.length),e.text=t,a.start=r.indexOf(""),a.end=r.lastIndexOf("")-"".length;var o=a.text.length-v.fixEolChars(s.value).length;if(o){for(e.moveStart("character",-t.length);o--;)t+="\n",a.end+=1;e.text=t}i.ieCachedRange&&(a.scrollTop=i.ieCachedScrollTop),i.ieCachedRange=null,this.setInputAreaSelection()}}else a.start=s.selectionStart,a.end=s.selectionEnd},this.restore=function(){null!=a.text&&a.text!=s.value&&(s.value=a.text),this.setInputAreaSelection(),s.scrollTop=a.scrollTop},this.getChunks=function(){var e=new n;return e.before=v.fixEolChars(a.text.substring(0,a.start)),e.startTag="",e.selection=v.fixEolChars(a.text.substring(a.start,a.end)),e.endTag="",e.after=v.fixEolChars(a.text.substring(a.end)),e.scrollTop=a.scrollTop,e},this.setChunks=function(e){e.before=e.before+e.startTag,e.after=e.endTag+e.after,this.start=e.before.length,this.end=e.before.length+e.selection.length,this.text=e.before+e.selection+e.after,this.scrollTop=e.scrollTop},this.init()}function f(r,o,i){var t,a,s,l=function(){var e=0;return window.innerHeight?e=window.pageYOffset:b.documentElement&&b.documentElement.scrollTop?e=b.documentElement.scrollTop:b.body&&(e=b.body.scrollTop),e},n=function(){if(o.preview){var e=o.input.value;if(!e||e!=s){s=e;var t=(new Date).getTime();e=r.makeHtml(e);var n=(new Date).getTime();a=n-t,h(e)}}},c=function(){t&&(clearTimeout(t),t=void 0);var e=0;3e3<(e=a)&&(e=3e3),t=setTimeout(n,e)};this.refresh=function(e){e?(s="",n()):c()},this.processingTime=function(){return a};var d,e,u,f=!0,p=function(e){var t=o.preview,n=t.parentNode,r=t.nextSibling;n.removeChild(t),t.innerHTML=e,r?n.insertBefore(t,r):n.appendChild(t)},g=function(e){o.preview.innerHTML=e},h=function(e){var t,n=m.getTop(o.input)-l();if(o.preview&&(!function(t){if(d)return d(t);try{g(t),d=g}catch(e){(d=p)(t)}}(e),i()),o.preview&&(o.preview.scrollTop=(o.preview.scrollHeight-o.preview.clientHeight)*((t=o.preview).scrollHeight<=t.clientHeight?1:t.scrollTop/(t.scrollHeight-t.clientHeight))),f)f=!1;else{var r=m.getTop(o.input)-l();T.isIE?setTimeout(function(){window.scrollBy(0,r-n)},0):window.scrollBy(0,r-n)}};e=o.input,u=c,v.addEvent(e,"input",u),e.onpaste=u,e.ondrop=u,v.addEvent(e,"keypress",u),v.addEvent(e,"keydown",u),n(),o.preview&&(o.preview.scrollTop=0)}function C(l,a,o,i,t,c){var s=a.input,d={};!function(){var e=a.buttonBar,s=document.createElement("div");s.id="wmd-button-row"+l,s.className="btn-toolbar",s=e.appendChild(s);var t=function(e,t,n,r,o){var i=document.createElement("button");i.className="btn btn-default";var a=document.createElement("i");return a.className=n,i.id=e+l,i.appendChild(a),i.title=t,$(i).tooltip({placement:"bottom",container:"body"}),r&&(i.textOp=r),u(i,!0),o?o.appendChild(i):s.appendChild(i),i},n=function(e){var t=document.createElement("div");return t.className="btn-group wmd-button-group"+e,t.id="wmd-button-group"+e+l,s.appendChild(t),t};group1=n(1),d.bold=t("wmd-bold-button","Bold - Ctrl+B","fa fa-bold",f("doBold"),group1),d.italic=t("wmd-italic-button","Italic - Ctrl+I","fa fa-italic",f("doItalic"),group1),group2=n(2),d.link=t("wmd-link-button","Link - Ctrl+L","fa fa-link",f(function(e,t){return this.doLinkOrImage(e,t,!1)}),group2),d.quote=t("wmd-quote-button","Blockquote - Ctrl+Q","fa fa-quote-left",f("doBlockquote"),group2),d.code=t("wmd-code-button","Code Sample - Ctrl+K","fa fa-code",f("doCode"),group2),d.image=t("wmd-image-button","Image - Ctrl+G","fa fa-picture-o",f(function(e,t){return this.doLinkOrImage(e,t,!0)}),group2),group3=n(3),d.olist=t("wmd-olist-button","Numbered List - Ctrl+O","fa fa-list-ol",f(function(e,t){this.doList(e,t,!0)}),group3),d.ulist=t("wmd-ulist-button","Bulleted List - Ctrl+U","fa fa-list-ul",f(function(e,t){this.doList(e,t,!1)}),group3),d.heading=t("wmd-heading-button","Heading - Ctrl+H","fa fa-header",f("doHeading"),group3),d.hr=t("wmd-hr-button","Horizontal Rule - Ctrl+R","fa fa-ellipsis-h",f("doHorizontalRule"),group3),group4=n(4),d.undo=t("wmd-undo-button","Undo - Ctrl+Z","fa fa-undo",null,group4),d.undo.execute=function(e){e&&e.undo()};var r=/win/.test(g.platform.toLowerCase())?"Redo - Ctrl+Y":"Redo - Ctrl+Shift+Z";if(d.redo=t("wmd-redo-button",r,"fa fa-rotate-right",null,group4),d.redo.execute=function(e){e&&e.redo()},c){group5=n(5),group5.className=group5.className+" pull-right";var o=document.createElement("button"),i=document.createElement("i");i.className="fa fa-question",o.appendChild(i),o.className="btn",o.id="wmd-help-button"+l,o.isHelp=!0,o.title=c.title||"Markdown Editing Help",$(o).tooltip({placement:"bottom",container:"body"}),o.onclick=c.handler,u(o,!0),group5.appendChild(o),d.help=o}p()}();var e="keydown";function n(e){if(s.focus(),e.textOp){o&&o.setCommandMode();var t=new w(a);if(!t)return;var n=t.getChunks(),r=function(){s.focus(),n&&t.setChunks(n),t.restore(),i.refresh()};e.textOp(n,r)||r()}e.execute&&e.execute(o)}function u(e,t){t?(e.disabled=!1,e.isHelp||(e.onclick=function(){return this.onmouseout&&this.onmouseout(),n(this),!1})):e.disabled=!0}function f(e){return"string"==typeof e&&(e=t[e]),function(){e.apply(t,arguments)}}function p(){o&&(u(d.undo,o.canUndo()),u(d.redo,o.canRedo()))}T.isOpera&&(e="keypress"),v.addEvent(s,e,function(e){if((e.ctrlKey||e.metaKey)&&!e.altKey&&!e.shiftKey){var t=e.charCode||e.keyCode;switch(String.fromCharCode(t).toLowerCase()){case"b":n(d.bold);break;case"i":n(d.italic);break;case"l":n(d.link);break;case"q":n(d.quote);break;case"k":n(d.code);break;case"g":n(d.image);break;case"o":n(d.olist);break;case"u":n(d.ulist);break;case"h":n(d.heading);break;case"r":n(d.hr);break;case"y":n(d.redo);break;case"z":e.shiftKey?n(d.redo):n(d.undo);break;default:return}e.preventDefault&&e.preventDefault(),window.event&&(window.event.returnValue=!1)}}),v.addEvent(s,"keyup",function(e){if(e.shiftKey&&!e.ctrlKey&&!e.metaKey&&13===(e.charCode||e.keyCode)){var t={};t.textOp=f("doAutoindent"),n(t)}}),T.isIE&&v.addEvent(s,"keydown",function(e){if(27===e.keyCode)return!1}),this.setUndoRedoButtonStates=p}function k(e){this.hooks=e}Markdown.Editor=function(o,i,a){i=i||"";var s=this.hooks=new Markdown.HookCollection;s.addNoop("onPreviewRefresh"),s.addNoop("postBlockquoteCreation"),s.addFalse("insertImageDialog"),this.getConverter=function(){return o};var l,c=this;this.run=function(){if(!l){l=new d(i);var t,e,n=new k(s),r=new f(o,l,function(){s.onPreviewRefresh()});/\?noundo/.test(b.location.href)||(t=new u(function(){r.refresh(),e&&e.setUndoRedoButtonStates()},l),this.textOperation=function(e){t.setCommandMode(),e(),c.refreshPreview()}),(e=new C(i,l,t,r,n,a)).setUndoRedoButtonStates(),(c.refreshPreview=function(){r.refresh(!0)})()}}},n.prototype.findTags=function(e,t){var n,r=this;e&&(n=v.extendRegExp(e,"","$"),this.before=this.before.replace(n,function(e){return r.startTag=r.startTag+e,""}),n=v.extendRegExp(e,"^",""),this.selection=this.selection.replace(n,function(e){return r.startTag=r.startTag+e,""})),t&&(n=v.extendRegExp(t,"","$"),this.selection=this.selection.replace(n,function(e){return r.endTag=e+r.endTag,""}),n=v.extendRegExp(t,"^",""),this.after=this.after.replace(n,function(e){return r.endTag=e+r.endTag,""}))},n.prototype.trimWhitespace=function(e){var t,n,r=this;e?t=n="":(t=function(e){return r.before+=e,""},n=function(e){return r.after=e+r.after,""}),this.selection=this.selection.replace(/^(\s*)/,t).replace(/(\s*)$/,n)},n.prototype.skipLines=function(e,t,n){var r,o;if(void 0===e&&(e=1),void 0===t&&(t=1),e++,t++,navigator.userAgent.match(/Chrome/)&&"X".match(/()./),this.selection=this.selection.replace(/(^\n*)/,""),this.startTag=this.startTag+p.$1,this.selection=this.selection.replace(/(\n*$)/,""),this.endTag=this.endTag+p.$1,this.startTag=this.startTag.replace(/(^\n*)/,""),this.before=this.before+p.$1,this.endTag=this.endTag.replace(/(\n*$)/,""),this.after=this.after+p.$1,this.before){for(r=o="";e--;)r+="\\n?",o+="\n";n&&(r="\\n*"),this.before=this.before.replace(new p(r+"$",""),o)}if(this.after){for(r=o="";t--;)r+="\\n?",o+="\n";n&&(r="\\n*"),this.after=this.after.replace(new p(r,""),o)}},v.isVisible=function(e){return window.getComputedStyle?"none"!==window.getComputedStyle(e,null).getPropertyValue("display"):e.currentStyle?"none"!==e.currentStyle.display:void 0},v.addEvent=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,!1)},v.removeEvent=function(e,t,n){e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n,!1)},v.fixEolChars=function(e){return e=(e=e.replace(/\r\n/g,"\n")).replace(/\r/g,"\n")},v.extendRegExp=function(e,t,n){null==t&&(t=""),null==n&&(n="");var r,o=e.toString();return o=(o=o.replace(/\/([gim]*)$/,function(e,t){return r=t,""})).replace(/(^\/|\/$)/g,""),new p(o=t+o+n,r)},m.getTop=function(e,t){var n=e.offsetTop;if(!t)for(;e=e.offsetParent;)n+=e.offsetTop;return n},m.getHeight=function(e){return e.offsetHeight||e.scrollHeight},m.getWidth=function(e){return e.offsetWidth||e.scrollWidth},m.getPageSize=function(){var e,t,n,r;return t=self.innerHeight&&self.scrollMaxY?(e=b.body.scrollWidth,self.innerHeight+self.scrollMaxY):b.body.scrollHeight>b.body.offsetHeight?(e=b.body.scrollWidth,b.body.scrollHeight):(e=b.body.offsetWidth,b.body.offsetHeight),self.innerHeight?(n=self.innerWidth,r=self.innerHeight):b.documentElement&&b.documentElement.clientHeight?(n=b.documentElement.clientWidth,r=b.documentElement.clientHeight):b.body&&(n=b.body.clientWidth,r=b.body.clientHeight),[Math.max(e,n),Math.max(t,r),n,r]},t.prompt=function(d,u,f,n){var p,g;void 0===f&&(f="");var h=function(e){27===(e.charCode||e.keyCode)&&m(!0)},m=function(e){v.removeEvent(b.body,"keydown",h);var t=g.value;return e?t=null:(t=t.replace(/^http:\/\/(https?|ftp):\/\//,"$1://"),/^(?:https?|ftp):\/\//.test(t)||(t="http://"+t)),$(p).modal("hide"),n(t),!1};setTimeout(function(){!function(){(p=b.createElement("div")).className="modal fade";var e=b.createElement("div");e.className="modal-dialog",p.appendChild(e);var t=b.createElement("div");t.className="modal-content",e.appendChild(t);var n=b.createElement("div");n.className="modal-header",n.innerHTML='<a class="close" data-dismiss="modal">Ã—</a> <h3 class="modal-title">'+d+"</h3>",t.appendChild(n);var r=b.createElement("div");r.className="modal-body",t.appendChild(r);var o=b.createElement("div");o.className="modal-footer",t.appendChild(o);var i=b.createElement("p");i.innerHTML=u,i.style.padding="5px",r.appendChild(i);var a=b.createElement("form"),s=a.style;a.onsubmit=function(){return m(!1)},s.padding="0",s.margin="0",r.appendChild(a),(g=b.createElement("input")).type="text",g.value=f,g.className="form-control",(s=g.style).display="block",s.width="80%",s.marginLeft=s.marginRight="auto",a.appendChild(g);var l=b.createElement("button");l.className="btn btn-primary",l.type="button",l.onclick=function(){return m(!1)},l.innerHTML="OK";var c=b.createElement("button");c.className="btn btn-danger",c.type="button",c.onclick=function(){return m(!0)},c.innerHTML="Cancel",o.appendChild(l),o.appendChild(c),v.addEvent(b.body,"keydown",h),b.body.appendChild(p)}();var e=f.length;if(void 0!==g.selectionStart)g.selectionStart=0,g.selectionEnd=e;else if(g.createTextRange){var t=g.createTextRange();t.collapse(!1),t.moveStart("character",-e),t.moveEnd("character",e),t.select()}$(p).on("shown",function(){g.focus()}),$(p).on("hidden",function(){p.parentNode.removeChild(p)}),$(p).modal()},0)};var e=k.prototype;e.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)",e.unwrap=function(e){var t=new p("([^\\n])\\n(?!(\\n|"+this.prefixes+"))","g");e.selection=e.selection.replace(t,"$1 $2")},e.wrap=function(e,t){this.unwrap(e);var n=new p("(.{1,"+t+"})( +|$\\n?)","gm"),r=this;e.selection=e.selection.replace(n,function(e,t){return new p("^"+r.prefixes,"").test(e)?e:t+"\n"}),e.selection=e.selection.replace(/\s+$/,"")},e.doBold=function(e,t){return this.doBorI(e,t,2,"strong text")},e.doItalic=function(e,t){return this.doBorI(e,t,1,"emphasized text")},e.doBorI=function(e,t,n,r){e.trimWhitespace(),e.selection=e.selection.replace(/\n{2,}/g,"\n");var o=/(\**$)/.exec(e.before)[0],i=/(^\**)/.exec(e.after)[0],a=Math.min(o.length,i.length);if(n<=a&&(2!=a||1!=n))e.before=e.before.replace(p("[*]{"+n+"}$",""),""),e.after=e.after.replace(p("^[*]{"+n+"}",""),"");else if(!e.selection&&i){e.after=e.after.replace(/^([*_]*)/,""),e.before=e.before.replace(/(\s?)$/,"");var s=p.$1;e.before=e.before+i+s}else{e.selection||i||(e.selection=r);var l=n<=1?"*":"**";e.before=e.before+l,e.after=l+e.after}},e.stripLinkDefs=function(e,i){return e=e.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(e,t,n,r,o){return i[t]=e.replace(/\s*$/,""),r?(i[t]=e.replace(/["(](.+?)[")]$/,""),r+o):""})},e.addLinkDef=function(e,t){var a=0,s={};e.before=this.stripLinkDefs(e.before,s),e.selection=this.stripLinkDefs(e.selection,s),e.after=this.stripLinkDefs(e.after,s);var n="",l=/(\[)((?:\[[^\]]*\]|[^\[\]])*)(\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g,c=function(e){a++,e=e.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+a+"]:"),n+="\n"+e},d=function(e,t,n,r,o,i){return n=n.replace(l,d),s[o]?(c(s[o]),t+n+r+a+i):e};e.before=e.before.replace(l,d),t?c(t):e.selection=e.selection.replace(l,d);var r=a;return e.after=e.after.replace(l,d),e.after&&(e.after=e.after.replace(/\n*$/,"")),e.after||(e.selection=e.selection.replace(/\n*$/,"")),e.after+="\n\n"+n,r},e.doLinkOrImage=function(r,o,i){if(r.trimWhitespace(),r.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/),!(1<r.endTag.length&&0<r.startTag.length)){if(r.selection=r.startTag+r.selection+r.endTag,r.startTag=r.endTag="",/\n\n/.test(r.selection))return void this.addLinkDef(r,null);var a=this,e=function(e){if(null!==e){r.selection=(" "+r.selection).replace(/([^\\](?:\\\\)*)(?=[[\]])/g,"$1\\").substr(1);var t=" [999]: "+e.replace(/^\s*(.*?)(?:\s+"(.+)")?\s*$/,function(e,t,n){return t=t.replace(/\?.*$/,function(e){return e.replace(/\+/g," ")}),t=decodeURIComponent(t),t=(t=encodeURI(t).replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")).replace(/\?.*$/,function(e){return e.replace(/\+/g,"%2b")}),n&&(n=n.trim?n.trim():n.replace(/^\s*/,"").replace(/\s*$/,""),n=$.trim(n).replace(/"/g,"quot;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),n?t+' "'+n+'"':t}),n=a.addLinkDef(r,t);r.startTag=i?"![":"[",r.endTag="]["+n+"]",r.selection||(r.selection=i?"enter image description here":"enter link description here")}o()};return i?this.hooks.insertImageDialog(e)||t.prompt("Insert Image",'<code>http://example.com/images/diagram.jpg "optional title"</code>',"http://",e):t.prompt("Insert Link",'<code>http://example.com/ "optional title"</code>',"http://",e),!0}r.startTag=r.startTag.replace(/!?\[/,""),r.endTag="",this.addLinkDef(r,null)},e.doAutoindent=function(t,e){var n=this,r=!1;t.before=t.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n"),t.before=t.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n"),t.before=t.before.replace(/(\n|^)[ \t]+\n$/,"\n\n"),t.selection||/^[ \t]*(?:\n|$)/.test(t.after)||(t.after=t.after.replace(/^[^\n]*/,function(e){return t.selection=e,""}),r=!0),/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]+.*\n$/.test(t.before)&&n.doList&&n.doList(t),/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(t.before)&&n.doBlockquote&&n.doBlockquote(t),/(\n|^)(\t|[ ]{4,}).*\n$/.test(t.before)&&n.doCode&&n.doCode(t),r&&(t.after=t.selection+t.after,t.selection="")},e.doBlockquote=function(o,e){o.selection=o.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(e,t,n,r){return o.before+=t,o.after=r+o.after,n}),o.before=o.before.replace(/(>[ \t]*)$/,function(e,t){return o.selection=t+o.selection,""}),o.selection=o.selection.replace(/^(\s|>)+$/,""),o.selection=o.selection||"Blockquote";var t,n="",r="";if(o.before){for(var i=o.before.replace(/\n$/,"").split("\n"),a=!1,s=0;s<i.length;s++){var l=!1;t=i[s],a=a&&0<t.length,/^>/.test(t)?(l=!0,!a&&1<t.length&&(a=!0)):l=!!/^[ \t]*$/.test(t)||a,l?n+=t+"\n":(r+=n+t,n="\n")}/(^|\n)>/.test(n)||(r+=n,n="")}o.startTag=n,o.before=r,o.after&&(o.after=o.after.replace(/^\n?/,"\n")),o.after=o.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(e){return o.endTag=e,""});var c=function(e){var n=e?"> ":"";o.startTag&&(o.startTag=o.startTag.replace(/\n((>|\s)*)\n$/,function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"})),o.endTag&&(o.endTag=o.endTag.replace(/^\n((>|\s)*)\n/,function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"}))};/^(?![ ]{0,3}>)/m.test(o.selection)?(this.wrap(o,h-2),o.selection=o.selection.replace(/^/gm,"> "),c(!0),o.skipLines()):(o.selection=o.selection.replace(/^[ ]{0,3}> ?/gm,""),this.unwrap(o),c(!1),!/^(\n|^)[ ]{0,3}>/.test(o.selection)&&o.startTag&&(o.startTag=o.startTag.replace(/\n{0,2}$/,"\n\n")),!/(\n|^)[ ]{0,3}>.*$/.test(o.selection)&&o.endTag&&(o.endTag=o.endTag.replace(/^\n{0,2}/,"\n\n"))),o.selection=this.hooks.postBlockquoteCreation(o.selection),/\n/.test(o.selection)||(o.selection=o.selection.replace(/^(> *)/,function(e,t){return o.startTag+=t,""}))},e.doCode=function(t,e){var n=/\S[ ]*$/.test(t.before);if(!/^[ ]*\S/.test(t.after)&&!n||/\n/.test(t.selection)){t.before=t.before.replace(/[ ]{4}$/,function(e){return t.selection=e+t.selection,""});var r=1,o=1;/(\n|^)(\t|[ ]{4,}).*\n$/.test(t.before)&&(r=0),/^\n(\t|[ ]{4,})/.test(t.after)&&(o=0),t.skipLines(r,o),t.selection?/^[ ]{0,3}\S/m.test(t.selection)?/\n/.test(t.selection)?t.selection=t.selection.replace(/^/gm,"    "):t.before+="    ":t.selection=t.selection.replace(/^[ ]{4}/gm,""):(t.startTag="    ",t.selection="enter code here")}else t.trimWhitespace(),t.findTags(/`/,/`/),t.startTag||t.endTag?t.endTag&&!t.startTag?(t.before+=t.endTag,t.endTag=""):t.startTag=t.endTag="":(t.startTag=t.endTag="`",t.selection||(t.selection="enter code here"))},e.doList=function(e,t,n){var r=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/,o="-",i=1,a=function(){var e;return n?(e=" "+i+". ",i++):e=" "+o+" ",e},s=function(e){return void 0===n&&(n=/^\s*\d/.test(e)),e=e.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(e){return a()})};if(e.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null),!e.before||/\n$/.test(e.before)||/^\n/.test(e.startTag)||(e.before+=e.startTag,e.startTag=""),e.startTag){var l=/\d+[.]/.test(e.startTag);if(e.startTag="",e.selection=e.selection.replace(/\n[ ]{4}/g,"\n"),this.unwrap(e),e.skipLines(),l&&(e.after=e.after.replace(r,s)),n==l)return}var c=1;e.before=e.before.replace(/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/,function(e){return/^\s*([*+-])/.test(e)&&(o=p.$1),c=/[^\n]\n\n[^\n]/.test(e)?1:0,s(e)}),e.selection||(e.selection="List item");var d=a(),u=1;e.after=e.after.replace(r,function(e){return u=/[^\n]\n\n[^\n]/.test(e)?1:0,s(e)}),e.trimWhitespace(!0),e.skipLines(c,u,!0);var f=(e.startTag=d).replace(/./g," ");this.wrap(e,h-f.length),e.selection=e.selection.replace(/\n/g,"\n"+f)},e.doHeading=function(e,t){if(e.selection=e.selection.replace(/\s+/g," "),e.selection=e.selection.replace(/(^\s+|\s+$)/g,""),!e.selection)return e.startTag="## ",e.selection="Heading",void(e.endTag=" ##");var n=0;e.findTags(/#+[ ]*/,/[ ]*#+/),/#+/.test(e.startTag)&&(n=p.lastMatch.length),e.startTag=e.endTag="",e.findTags(null,/\s?(-+|=+)/),/=+/.test(e.endTag)&&(n=1),/-+/.test(e.endTag)&&(n=2),e.startTag=e.endTag="",e.skipLines(1,1);var r=0==n?2:n-1;if(0<r){var o=2<=r?"-":"=",i=e.selection.length;for(h<i&&(i=h),e.endTag="\n";i--;)e.endTag+=o}},e.doHorizontalRule=function(e,t){e.startTag="----------\n",e.selection="",e.skipLines(2,1,!0)}}();