GMaps.prototype.toImage=function(e){e=e||{};var r={};if(r.size=e.size||[this.el.clientWidth,this.el.clientHeight],r.lat=this.getCenter().lat(),r.lng=this.getCenter().lng(),0<this.markers.length){r.markers=[];for(var s=0;s<this.markers.length;s++)r.markers.push({lat:this.markers[s].getPosition().lat(),lng:this.markers[s].getPosition().lng()})}if(0<this.polylines.length){var t=this.polylines[0];r.polyline={},r.polyline.path=google.maps.geometry.encoding.encodePath(t.getPath()),r.polyline.strokeColor=t.strokeColor,r.polyline.strokeOpacity=t.strokeOpacity,r.polyline.strokeWeight=t.strokeWeight}return GMaps.staticMapURL(r)},GMaps.staticMapURL=function(e){var r,s=[],t="http://maps.googleapis.com/maps/api/staticmap";e.url&&(t=e.url,delete e.url),t+="?";var o=e.markers;delete e.markers,!o&&e.marker&&(o=[e.marker],delete e.marker);var l=e.polyline;if(delete e.polyline,e.center)s.push("center="+e.center),delete e.center;else if(e.address)s.push("center="+e.address),delete e.address;else if(e.lat)s.push(["center=",e.lat,",",e.lng].join("")),delete e.lat,delete e.lng;else if(e.visible){var i=encodeURI(e.visible.join("|"));s.push("visible="+i)}var a=e.size;a?(a.join&&(a=a.join("x")),delete e.size):a="630x300",s.push("size="+a),e.zoom||(e.zoom=15);var n=!e.hasOwnProperty("sensor")||!!e.sensor;for(var p in delete e.sensor,s.push("sensor="+n),e)e.hasOwnProperty(p)&&s.push(p+"="+e[p]);if(o)for(var h,c,g=0;r=o[g];g++)h=[],r.size&&"normal"!==r.size?h.push("size:"+r.size):r.icon&&h.push("icon:"+encodeURI(r.icon)),r.color&&h.push("color:"+r.color.replace("#","0x")),r.label&&h.push("label:"+r.label[0].toUpperCase()),c=r.address?r.address:r.lat+","+r.lng,h.length||0===g?(h.push(c),h=h.join("|"),s.push("markers="+encodeURI(h))):(h=s.pop()+encodeURI("|"+c),s.push(h));function u(e,r){if("#"===e[0]&&(e=e.replace("#","0x"),r)){if(r=parseFloat(r),0===(r=Math.min(1,Math.max(r,0))))return"0x00000000";1===(r=(255*r).toString(16)).length&&(r+=r),e=e.slice(0,8)+r}return e}if(l){if(r=l,l=[],r.strokeWeight&&l.push("weight:"+parseInt(r.strokeWeight,10)),r.strokeColor){var d=u(r.strokeColor,r.strokeOpacity);l.push("color:"+d)}if(r.fillColor){var f=u(r.fillColor,r.fillOpacity);l.push("fillcolor:"+f)}var m=r.path;if(m.join)for(var k,v=0;k=m[v];v++)l.push(k.join(","));else l.push("enc:"+m);l=l.join("|"),s.push("path="+encodeURI(l))}return t+(s=s.join("&"))};