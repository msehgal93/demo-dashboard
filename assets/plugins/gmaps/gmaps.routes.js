var travelMode,unitSystem;GMaps.prototype.getRoutes=function(s){switch(s.travelMode){case"bicycling":travelMode=google.maps.TravelMode.BICYCLING;break;case"transit":travelMode=google.maps.TravelMode.TRANSIT;break;case"driving":travelMode=google.maps.TravelMode.DRIVING;break;default:travelMode=google.maps.TravelMode.WALKING}unitSystem="imperial"===s.unitSystem?google.maps.UnitSystem.IMPERIAL:google.maps.UnitSystem.METRIC;var t=extend_object({avoidHighways:!1,avoidTolls:!1,optimizeWaypoints:!1,waypoints:[]},s);t.origin=/string/.test(typeof s.origin)?s.origin:new google.maps.LatLng(s.origin[0],s.origin[1]),t.destination=/string/.test(typeof s.destination)?s.destination:new google.maps.LatLng(s.destination[0],s.destination[1]),t.travelMode=travelMode,t.unitSystem=unitSystem,delete t.callback;var i=this;(new google.maps.DirectionsService).route(t,function(t,e){if(e===google.maps.DirectionsStatus.OK)for(var o in t.routes)t.routes.hasOwnProperty(o)&&i.routes.push(t.routes[o]);s.callback&&s.callback(i.routes)})},GMaps.prototype.removeRoutes=function(){this.routes=[]},GMaps.prototype.getElevations=function(t){0<(t=extend_object({locations:[],path:!1,samples:256},t)).locations.length&&0<t.locations[0].length&&(t.locations=array_flat(array_map([t.locations],arrayToLatLng,!1)));var o=t.callback;delete t.callback;var e=new google.maps.ElevationService;if(t.path){var s={path:t.locations,samples:t.samples};e.getElevationAlongPath(s,function(t,e){o&&"function"==typeof o&&o(t,e)})}else delete t.path,delete t.samples,e.getElevationForLocations(t,function(t,e){o&&"function"==typeof o&&o(t,e)})},GMaps.prototype.cleanRoute=GMaps.prototype.removePolylines,GMaps.prototype.drawRoute=function(e){var o=this;this.getRoutes({origin:e.origin,destination:e.destination,travelMode:e.travelMode,waypoints:e.waypoints,unitSystem:e.unitSystem,callback:function(t){0<t.length&&(o.drawPolyline({path:t[t.length-1].overview_path,strokeColor:e.strokeColor,strokeOpacity:e.strokeOpacity,strokeWeight:e.strokeWeight}),e.callback&&e.callback(t[t.length-1]))}})},GMaps.prototype.travelRoute=function(a){if(a.origin&&a.destination)this.getRoutes({origin:a.origin,destination:a.destination,travelMode:a.travelMode,waypoints:a.waypoints,callback:function(t){if(0<t.length&&a.start&&a.start(t[t.length-1]),0<t.length&&a.step){var e=t[t.length-1];if(0<e.legs.length)for(var o,s=e.legs[0].steps,i=0;o=s[i];i++)o.step_number=i,a.step(o,e.legs[0].steps.length-1)}0<t.length&&a.end&&a.end(t[t.length-1])}});else if(a.route&&0<a.route.legs.length)for(var t,e=a.route.legs[0].steps,o=0;t=e[o];o++)t.step_number=o,a.step(t)},GMaps.prototype.drawSteppedRoute=function(a){var n=this;if(a.origin&&a.destination)this.getRoutes({origin:a.origin,destination:a.destination,travelMode:a.travelMode,waypoints:a.waypoints,callback:function(t){if(0<t.length&&a.start&&a.start(t[t.length-1]),0<t.length&&a.step){var e=t[t.length-1];if(0<e.legs.length)for(var o,s=e.legs[0].steps,i=0;o=s[i];i++)o.step_number=i,n.drawPolyline({path:o.path,strokeColor:a.strokeColor,strokeOpacity:a.strokeOpacity,strokeWeight:a.strokeWeight}),a.step(o,e.legs[0].steps.length-1)}0<t.length&&a.end&&a.end(t[t.length-1])}});else if(a.route&&0<a.route.legs.length)for(var t,e=a.route.legs[0].steps,o=0;t=e[o];o++)t.step_number=o,n.drawPolyline({path:t.path,strokeColor:a.strokeColor,strokeOpacity:a.strokeOpacity,strokeWeight:a.strokeWeight}),a.step(t)},GMaps.Route=function(t){this.origin=t.origin,this.destination=t.destination,this.waypoints=t.waypoints,this.map=t.map,this.route=t.route,this.step_count=0,this.steps=this.route.legs[0].steps,this.steps_length=this.steps.length,this.polyline=this.map.drawPolyline({path:new google.maps.MVCArray,strokeColor:t.strokeColor,strokeOpacity:t.strokeOpacity,strokeWeight:t.strokeWeight}).getPath()},GMaps.Route.prototype.getRoute=function(t){var o=this;this.map.getRoutes({origin:this.origin,destination:this.destination,travelMode:t.travelMode,waypoints:this.waypoints||[],callback:function(){o.route=e[0],t.callback&&t.callback.call(o)}})},GMaps.Route.prototype.back=function(){if(0<this.step_count){this.step_count--;var t=this.route.legs[0].steps[this.step_count].path;for(var e in t)t.hasOwnProperty(e)&&this.polyline.pop()}},GMaps.Route.prototype.forward=function(){if(this.step_count<this.steps_length){var t=this.route.legs[0].steps[this.step_count].path;for(var e in t)t.hasOwnProperty(e)&&this.polyline.push(t[e]);this.step_count++}};