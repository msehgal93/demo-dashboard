!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","angular","./jquery.fileupload-image","./jquery.fileupload-audio","./jquery.fileupload-video","./jquery.fileupload-validate"],e):e()}(function(){"use strict";angular.module("blueimp.fileupload",[]).provider("fileUpload",function(){var e,o=function(){var e=angular.element(this).fileupload("option","scope")();angular.injector(["ng"]).get("$timeout")(function(){e.$apply()})};e=this.defaults={handleResponse:function(e,o){var n=o.result&&o.result.files;n?o.scope().replace(o.files,n):(o.errorThrown||"error"===o.textStatus)&&(o.files[0].error=o.errorThrown||o.textStatus)},add:function(e,r){var t=r.scope();r.process(function(){return t.process(r)}).always(function(){var e,o=r.files[0],n=function(){return r.submit()};for(e=0;e<r.files.length;e+=1)r.files[e]._index=e;o.$cancel=function(){return t.clear(r.files),r.abort()},o.$state=function(){return r.state()},o.$progress=function(){return r.progress()},o.$response=function(){return r.response()},"rejected"===o.$state()?o._$submit=n:o.$submit=n,t.$apply(function(){var e=t.option("prependFiles")?"unshift":"push";Array.prototype[e].apply(t.queue,r.files),o.$submit&&(t.option("autoUpload")||r.autoUpload)&&!1!==r.autoUpload&&o.$submit()})})},progress:function(e,o){o.scope().$apply()},done:function(e,o){var n=this;o.scope().$apply(function(){o.handleResponse.call(n,e,o)})},fail:function(e,o){var n=this;if("abort"!==o.errorThrown){if(o.dataType&&o.dataType.indexOf("json")===o.dataType.length-4)try{o.result=angular.fromJson(o.jqXHR.responseText)}catch(e){}o.scope().$apply(function(){o.handleResponse.call(n,e,o)})}},stop:o,processstart:o,processstop:o,getNumberOfFiles:function(){return this.scope().queue.length},dataType:"json",prependFiles:!0,autoUpload:!1},this.$get=[function(){return{defaults:e}}]}).provider("formatFileSizeFilter",function(){var l={units:[{size:1e9,suffix:" GB"},{size:1e6,suffix:" MB"},{size:1e3,suffix:" KB"}]};this.defaults=l,this.$get=function(){return function(e){if(!angular.isNumber(e))return"";for(var o,n,r=!0,t=0;r;){if(o=(r=l.units[t]).prefix||"",n=r.suffix||"",t===l.units.length-1||e>=r.size)return o+(e/r.size).toFixed(2)+n;t+=1}}}}).controller("FileUploadController",["$scope","$element","$attrs","$window","fileUpload",function(n,r,e,o,t){var l={progress:function(){return r.fileupload("progress")},active:function(){return r.fileupload("active")},option:function(e,o){return r.fileupload("option",e,o)},add:function(e){return r.fileupload("add",e)},send:function(e){return r.fileupload("send",e)},process:function(e){return r.fileupload("process",e)},processing:function(e){return r.fileupload("processing",e)}};n.disabled=!o.jQuery.support.fileInput,n.queue=n.queue||[],n.clear=function(e){var o=this.queue,n=o.length,r=e,t=1;for(angular.isArray(e)&&(r=e[0],t=e.length);n;)if(o[n-=1]===r)return o.splice(n,t)},n.replace=function(e,o){var n,r,t=this.queue,l=e[0];for(n=0;n<t.length;n+=1)if(t[n]===l){for(r=0;r<o.length;r+=1)t[n+r]=o[r];return}},n.applyOnQueue=function(e){var o,n,r=this.queue.slice(0);for(o=0;o<r.length;o+=1)(n=r[o])[e]&&n[e]()},n.submit=function(){this.applyOnQueue("$submit")},n.cancel=function(){this.applyOnQueue("$cancel")},angular.extend(n,l),r.fileupload(angular.extend({scope:function(){return n}},t.defaults)).on("fileuploadadd",function(e,o){o.scope=n.option("scope")}).on(["fileuploadadd","fileuploadsubmit","fileuploadsend","fileuploaddone","fileuploadfail","fileuploadalways","fileuploadprogress","fileuploadprogressall","fileuploadstart","fileuploadstop","fileuploadchange","fileuploadpaste","fileuploaddrop","fileuploaddragover","fileuploadchunksend","fileuploadchunkdone","fileuploadchunkfail","fileuploadchunkalways","fileuploadprocessstart","fileuploadprocess","fileuploadprocessdone","fileuploadprocessfail","fileuploadprocessalways","fileuploadprocessstop"].join(" "),function(e,o){n.$emit(e.type,o).defaultPrevented&&e.preventDefault()}).on("remove",function(){var e;for(e in l)l.hasOwnProperty(e)&&delete n[e]}),n.$watch(e.fileUpload,function(e){e&&r.fileupload("option",e)})}]).controller("FileUploadProgressController",["$scope","$attrs","$parse",function(o,e,n){var r=n(e.fileUploadProgress),t=function(){var e=r(o);e&&e.total&&(o.num=Math.floor(e.loaded/e.total*100))};t(),o.$watch(e.fileUploadProgress+".loaded",function(e,o){e!==o&&t()})}]).controller("FileUploadPreviewController",["$scope","$element","$attrs","$parse",function(e,o,n,r){var t=r(n.fileUploadPreview)(e);t.preview&&o.append(t.preview)}]).directive("fileUpload",function(){return{controller:"FileUploadController"}}).directive("fileUploadProgress",function(){return{controller:"FileUploadProgressController"}}).directive("fileUploadPreview",function(){return{controller:"FileUploadPreviewController"}}).directive("download",function(){return function(e,o){o.on("dragstart",function(e){try{e.originalEvent.dataTransfer.setData("DownloadURL",["application/octet-stream",o.prop("download"),o.prop("href")].join(":"))}catch(e){}})}})});