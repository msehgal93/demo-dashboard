!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","load-image-meta","load-image-exif","load-image-ios","canvas-to-blob","./jquery.fileupload-process"],e):e(window.jQuery,window.loadImage)}(function(r,d){"use strict";r.blueimp.fileupload.prototype.options.processQueue.unshift({action:"loadImageMetaData",disableImageHead:"@",disableExif:"@",disableExifThumbnail:"@",disableExifSub:"@",disableExifGps:"@",disabled:"@disableImageMetaDataLoad"},{action:"loadImage",prefix:!0,fileTypes:"@",maxFileSize:"@",noRevoke:"@",disabled:"@disableImageLoad"},{action:"resizeImage",prefix:"image",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",disabled:"@disableImageResize"},{action:"saveImage",disabled:"@disableImageResize"},{action:"saveImageMetaData",disabled:"@disableImageMetaDataSave"},{action:"resizeImage",prefix:"preview",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",thumbnail:"@",canvas:"@",disabled:"@disableImagePreview"},{action:"setImage",name:"@imagePreviewName",disabled:"@disableImagePreview"}),r.widget("blueimp.fileupload",r.blueimp.fileupload,{options:{loadImageFileTypes:/^image\/(gif|jpeg|png)$/,loadImageMaxFileSize:1e7,imageMaxWidth:1920,imageMaxHeight:1080,imageCrop:!1,disableImageResize:!0,previewMaxWidth:80,previewMaxHeight:80,previewOrientation:!0,previewThumbnail:!0,previewCrop:!1,previewCanvas:!0},processActions:{loadImage:function(i,e){if(e.disabled)return i;var a=this,t=i.files[i.index],n=r.Deferred();return"number"===r.type(e.maxFileSize)&&t.size>e.maxFileSize||e.fileTypes&&!e.fileTypes.test(t.type)||!d(t,function(e){e.src&&(i.img=e),n.resolveWith(a,[i])},e)?i:n.promise()},resizeImage:function(i,e){if(e.disabled)return i;var a,t,n,s=this,l=r.Deferred(),o=function(e){i[e.getContext?"canvas":"img"]=e,l.resolveWith(s,[i])};return e=r.extend({canvas:!0},e),i.exif&&(!0===e.orientation&&(e.orientation=i.exif.get("Orientation")),e.thumbnail&&(a=i.exif.get("Thumbnail")))?(d(a,o,e),l.promise()):!(t=e.canvas&&i.canvas||i.img)||(n=d.scale(t,e)).width===t.width&&n.height===t.height?i:(o(n),l.promise())},saveImage:function(i,e){if(!i.canvas||e.disabled)return i;var a=this,t=i.files[i.index],n=t.name,s=r.Deferred(),l=function(e){e.name||(t.type===e.type?e.name=t.name:t.name&&(e.name=t.name.replace(/\..+$/,"."+e.type.substr(6)))),i.files[i.index]=e,s.resolveWith(a,[i])};if(i.canvas.mozGetAsFile)l(i.canvas.mozGetAsFile(/^image\/(jpeg|png)$/.test(t.type)&&n||(n&&n.replace(/\..+$/,"")||"blob")+".png",t.type));else{if(!i.canvas.toBlob)return i;i.canvas.toBlob(l,t.type)}return s.promise()},loadImageMetaData:function(i,e){if(e.disabled)return i;var a=this,t=r.Deferred();return d.parseMetaData(i.files[i.index],function(e){r.extend(i,e),t.resolveWith(a,[i])},e),t.promise()},saveImageMetaData:function(e,i){if(!(e.imageHead&&e.canvas&&e.canvas.toBlob)||i.disabled)return e;var a=e.files[e.index],t=new Blob([e.imageHead,this._blobSlice.call(a,20)],{type:a.type});return t.name=a.name,e.files[e.index]=t,e},setImage:function(e,i){var a=e.canvas||e.img;return a&&!i.disabled&&(e.files[e.index][i.name||"preview"]=a),e}}})});