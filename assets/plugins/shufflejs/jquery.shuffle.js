!function(t){"function"==typeof define&&define.amd?define(["jquery","modernizr"],t):t(window.jQuery,window.Modernizr)}(function(f,t,o){"use strict";if("object"!=typeof t)throw new Error("Shuffle.js requires Modernizr.\nhttp://vestride.github.io/Shuffle/#dependencies");var e,a=t.prefixed("transition"),s=t.prefixed("transitionDelay"),n=t.prefixed("transitionDuration"),r={WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[a],i=t.prefixed("transform"),l=(e=i)?e.replace(/([A-Z])/g,function(t,e){return"-"+e.toLowerCase()}).replace(/^ms-/,"-ms-"):"",u=t.csstransforms&&t.csstransitions,h=t.csstransforms3d,d="shuffle",c="all";var p=0,m=function(t,e){e=e||{},f.extend(this,m.options,e,m.settings),this.$el=f(t),this.$window=f(window),this.unique="shuffle_"+p++,this._fire(m.EventType.LOADING),this._init(),setTimeout(f.proxy(function(){this.initialized=!0,this._fire(m.EventType.DONE)},this),16)};return m.EventType={LOADING:"loading",DONE:"done",SHRINK:"shrink",SHRUNK:"shrunk",FILTER:"filter",FILTERED:"filtered",SORTED:"sorted",LAYOUT:"layout",REMOVED:"removed"},m.prototype={_init:function(){var t,e,i=this,s=f.proxy(i._onResize,i),n=i.throttle?i.throttle(s,i.throttleTime):s,r=i.initialSort?i.initialSort:null;i._layoutList=[],i._shrinkList=[],i._setVars(),i._resetCols(),i._addClasses(),i._initItems(),i.$window.on("resize."+d+"."+i.unique,n),t=i.$el.css(["paddingLeft","paddingRight","position"]),e=i._getOuterWidth(i.$el[0]),"static"===t.position&&(i.$el[0].style.position="relative"),i.offset={left:parseInt(t.paddingLeft,10)||0,top:parseInt(t.paddingTop,10)||0},i._setColumns(parseInt(e,10)),i.shuffle(i.group,r),i.supported&&setTimeout(function(){i._setTransitions(),i.$el[0].style[a]="height "+i.speed+"ms "+i.easing},0)},_addClasses:function(){this.$el.addClass(d),this.$items.addClass("shuffle-item filtered")},_setVars:function(){var t=this,e=t.columnWidth;t.$items=t._getItems(),0===e&&null!==t.sizer&&(e=t.sizer),"string"==typeof e?t.$sizer=t.$el.find(e):e&&e.nodeType&&1===e.nodeType?t.$sizer=f(e):e&&e.jquery&&(t.$sizer=e),t.$sizer&&t.$sizer.length&&(t.useSizer=!0,t.sizer=t.$sizer[0])},_filter:function(s,t){var n=this,e=t!==o?t:n.$items,r=f();return s=s||n.lastFilter,n._fire(m.EventType.FILTER),f.isFunction(s)?e.each(function(){var t=f(this);s.call(t[0],t,n)&&(r=r.add(t))}):(n.group=s)===c?r=e:e.each(function(){var t=f(this),e=t.data("groups"),i=n.delimeter&&!f.isArray(e)?e.split(n.delimeter):e;-1<f.inArray(s,i)&&(r=r.add(t))}),n._toggleFilterClasses(e,r),t=e=null,r},_toggleFilterClasses:function(t,e){var i="concealed",s="filtered";t.filter(e).each(function(){var t=f(this);t.hasClass(i)&&t.removeClass(i),t.hasClass(s)||t.addClass(s)}),t.not(e).each(function(){var t=f(this);t.hasClass(i)||t.addClass(i),t.hasClass(s)&&t.removeClass(s)})},_initItems:function(t){(t=t||this.$items).css(this.itemCss).data("position",{x:0,y:0})},_updateItemCount:function(){this.visibleItems=this.$items.filter(".filtered").length},_setTransition:function(t){t.style[a]=l+" "+this.speed+"ms "+this.easing+", opacity "+this.speed+"ms "+this.easing},_setTransitions:function(t){var e=this;(t=t||e.$items).each(function(){e._setTransition(this)})},_setSequentialDelay:function(t){var i=this;i.supported&&f.each(t,function(t,e){e.style[s]="0ms,"+(t+1)*i.sequentialFadeDelay+"ms",f(e).on(r+"."+i.unique,function(t){var e=t.currentTarget;e===t.target&&(e.style[s]="0ms",f(e).off(r+"."+i.unique))})})},_getItems:function(){return this.$el.children(this.itemSelector)},_getPreciseDimension:function(t,e){var i;return i=window.getComputedStyle?window.getComputedStyle(t,null)[e]:f(t).css(e),parseFloat(i)},_getOuterWidth:function(t,e){var i=t.offsetWidth;if(e){var s=f(t).css(["marginLeft","marginRight"]);i+=(parseFloat(s.marginLeft)||0)+(parseFloat(s.marginRight)||0)}return i},_getOuterHeight:function(t,e){var i=t.offsetHeight;if(e){var s=f(t).css(["marginTop","marginBottom"]);i+=(parseFloat(s.marginTop)||0)+(parseFloat(s.marginBottom)||0)}return i},_getColumnSize:function(t,e){var i;return 0===(i=f.isFunction(this.columnWidth)?this.columnWidth(e):this.useSizer?this._getPreciseDimension(this.sizer,"width"):this.columnWidth?this.columnWidth:0<this.$items.length?this._getOuterWidth(this.$items[0],!0):e)&&(i=e),i+t},_getGutterSize:function(t){return f.isFunction(this.gutterWidth)?this.gutterWidth(t):this.useSizer?this._getPreciseDimension(this.sizer,"marginLeft"):this.gutterWidth},_setColumns:function(t){var e=t||this._getOuterWidth(this.$el[0]),i=this._getGutterSize(e),s=this._getColumnSize(i,e),n=(e+i)/s;Math.abs(Math.round(n)-n)<.03&&(n=Math.round(n)),this.cols=Math.max(Math.floor(n),1),this.containerWidth=e,this.colWidth=s},_setContainerSize:function(){this.$el.css("height",Math.max.apply(Math,this.colYs))},_fire:function(t,e){this.$el.trigger(t+"."+d,e&&e.length?e:[this])},_layout:function(t,a,l){var u=this;a=a||u._filterEnd,f.each(t,function(t,e){var i=f(e),s=i.data(),n=s.position,r=u._getItemPosition(i);if(i.data("position",r),r.x!==n.x||r.y!==n.y||1!==s.scale){var o={$item:i,x:r.x,y:r.y,scale:1};l?(o.skipTransition=!0,o.opacity=0):(o.opacity=1,o.callback=a),u.styleQueue.push(o),u._layoutList.push(i[0])}}),u._processStyleQueue(),u._setContainerSize()},_resetCols:function(){var t=this.cols;for(this.colYs=[];t--;)this.colYs.push(0)},_reLayout:function(){this._resetCols(),this.lastSort?this.sort(this.lastSort,!0):this._layout(this.$items.filter(".filtered").get(),this._filterEnd)},_getItemPosition:function(t){var e=this,i=e._getOuterWidth(t[0],!0)/e.colWidth;Math.abs(Math.round(i)-i)<.03&&(i=Math.round(i));var s=Math.min(Math.ceil(i),e.cols);if(1===s)return e._placeItem(t,e.colYs);var n,r,o=e.cols+1-s,a=[];for(r=0;r<o;r++)n=e.colYs.slice(r,r+s),a[r]=Math.max.apply(Math,n);return e._placeItem(t,a)},_placeItem:function(t,e){for(var i=this,s=Math.min.apply(Math,e),n=0,r=0,o=e.length;r<o;r++)if(e[r]>=s-i.buffer&&e[r]<=s+i.buffer){n=r;break}var a={x:Math.round(i.colWidth*n+i.offset.left),y:Math.round(s+i.offset.top)},l=s+i._getOuterHeight(t[0],!0),u=i.cols+1-o;for(r=0;r<u;r++)i.colYs[n+r]=l;return a},_shrink:function(t,s){var n=this,e=t||n.$items.filter(".concealed");s=s||n._shrinkEnd,e.length&&(n._fire(m.EventType.SHRINK),e.each(function(){var t=f(this),e=t.data();if(!(.001===e.scale)){var i={$item:t,x:e.position.x,y:e.position.y,scale:.001,opacity:0,callback:s};n.styleQueue.push(i),n._shrinkList.push(t[0])}}))},_onResize:function(){this.enabled&&!this.destroyed&&(this._getOuterWidth(this.$el[0])!==this.containerWidth&&this.resized())},_getItemTransformString:function(t,e,i){return h?"translate3d("+t+"px, "+e+"px, 0) scale3d("+i+", "+i+", 1)":"translate("+t+"px, "+e+"px) scale("+i+", "+i+")"},_getStylesForTransition:function(t){var e={opacity:t.opacity};return this.supported?t.x!==o&&(e[i]=this._getItemTransformString(t.x,t.y,t.scale)):(e.left=t.x,e.top=t.y),1===t.opacity&&(e.visibility="visible"),e},_transition:function(t){t.$item.data("scale",t.scale);var e=this._getStylesForTransition(t);this._startItemAnimation(t.$item,e,t.callback)},_startItemAnimation:function(t,e,i){var s=1===e.opacity,n=f.proxy(this._handleItemAnimationEnd,this,i||f.noop,t[0],s);this.supported?(t.css(e),this.initialized?t.on(r+".shuffleitem",n):n()):("visibility"in e&&(t.css("visibility",e.visibility),delete e.visibility),t.stop(!0).animate(e,this.speed,"swing",n))},_handleItemAnimationEnd:function(t,e,i,s){if(s){if(s.target!==e)return;f(e).off(".shuffleitem")}0<this._layoutList.length&&-1<f.inArray(e,this._layoutList)?(this._fire(m.EventType.LAYOUT),t.call(this),this._layoutList.length=0):0<this._shrinkList.length&&-1<f.inArray(e,this._shrinkList)&&(t.call(this),this._shrinkList.length=0),i||(e.style.visibility="hidden")},_processStyleQueue:function(){var i=this;f.each(this.styleQueue,function(t,e){e.skipTransition?i._skipTransition(e.$item[0],function(){e.$item.css(i._getStylesForTransition(e))}):i._transition(e)}),i.styleQueue.length=0},_shrinkEnd:function(){this._fire(m.EventType.SHRUNK)},_filterEnd:function(){this._fire(m.EventType.FILTERED)},_sortEnd:function(){this._fire(m.EventType.SORTED)},_skipTransition:function(t,e,i){var s=t.style[n];t.style[n]="0ms",f.isFunction(e)?e():t.style[e]=i;t.offsetWidth;t.style[n]=s},_addItems:function(t,e,i){var s=this;s.supported||(e=!1),t.addClass("shuffle-item"),s._initItems(t),s._setTransitions(t),s.$items=s._getItems(),t.css("opacity",0);var n=s._filter(o,t),r=n.get();s._updateItemCount(),e?(s._layout(r,null,!0),i&&s._setSequentialDelay(n),s._revealAppended(n)):s._layout(r)},_revealAppended:function(t){var i=this;setTimeout(function(){t.each(function(t,e){i._transition({$item:f(e),opacity:1,scale:1})})},i.revealAppendedDelay)},shuffle:function(t,e){var i=this;i.enabled&&(t||(t=c),i._filter(t),i.lastFilter=t,i._updateItemCount(),i._shrink(),e&&(i.lastSort=e),i._reLayout())},sort:function(t,e){var i=this,s=i.$items.filter(".filtered").sorted(t);e||i._resetCols(),i._layout(s,function(){e&&i._filterEnd(),i._sortEnd()}),i.lastSort=t},resized:function(t){this.enabled&&(t||this._setColumns(),this._reLayout())},layout:function(){this.update(!0)},update:function(t){this.resized(t)},appended:function(t,e,i){e=!1!==e,i=!1!==i,this._addItems(t,e,i)},disable:function(){this.enabled=!1},enable:function(t){!(this.enabled=!0)!==t&&this.update()},remove:function(e){if(e.length&&e.jquery){return this._shrink(e,function(){var t=this;e.remove(),setTimeout(function(){t.$items=t._getItems(),t.layout(),t._updateItemCount(),t._fire(m.EventType.REMOVED,[e,t]),e=null},0)}),this._processStyleQueue(),this}},destroy:function(){var t=this;t.$window.off("."+t.unique),t.$el.removeClass(d).removeAttr("style").removeData(d),t.$items.removeAttr("style").removeClass("concealed filtered shuffle-item"),t.$window=null,t.$items=null,t.$el=null,t.$sizer=null,t.sizer=null,t.destroyed=!0}},m.options={group:c,speed:250,easing:"ease-out",itemSelector:"",sizer:null,gutterWidth:0,columnWidth:0,delimeter:null,buffer:0,initialSort:null,throttle:function(i,s,n){var r,o,a,l=null,u=0;n=n||{};var h=function(){u=!1===n.leading?0:f.now(),l=null,a=i.apply(r,o),r=o=null};return function(){var t=f.now();u||!1!==n.leading||(u=t);var e=s-(t-u);return r=this,o=arguments,e<=0||s<e?(clearTimeout(l),l=null,u=t,a=i.apply(r,o),r=o=null):l||!1===n.trailing||(l=setTimeout(h,e)),a}},throttleTime:300,sequentialFadeDelay:150,supported:u},m.settings={$sizer:null,useSizer:!1,itemCss:{position:"absolute",top:0,left:0},offset:{top:0,left:0},revealAppendedDelay:300,enabled:!0,destroyed:!1,initialized:!1,styleQueue:[]},f.fn.shuffle=function(i){var s=Array.prototype.slice.call(arguments,1);return this.each(function(){var t=f(this),e=t.data(d);e||(e=new m(t,i),t.data(d,e)),"string"==typeof i&&e[i]&&e[i].apply(e,s)})},f.fn.sorted=function(t){var n=f.extend({},f.fn.sorted.defaults,t),e=this.get(),r=!1;return e.length?n.randomize?f.fn.sorted.randomize(e):(n.by!==f.noop&&null!==n.by&&n.by!==o&&e.sort(function(t,e){if(r)return 0;var i=n.by(f(t)),s=n.by(f(e));return i===o&&s===o?(r=!0,0):"sortFirst"===i||"sortLast"===s?-1:"sortLast"===i||"sortFirst"===s?1:i<s?-1:s<i?1:0}),r?this.get():(n.reverse&&e.reverse(),e)):[]},f.fn.sorted.defaults={reverse:!1,by:null,randomize:!1},f.fn.sorted.randomize=function(t){var e,i,s=t.length;if(!s)return t;for(;--s;)e=t[i=Math.floor(Math.random()*(s+1))],t[i]=t[s],t[s]=e;return t},m});