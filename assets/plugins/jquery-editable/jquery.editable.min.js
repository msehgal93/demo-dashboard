!function(l,t){"use strict";var d=l(t),c=!1,h=!1,e="data-edit-event",a="data-is-editing",g="data-is-empty",i="dbltap",n="ontouchend"in t,s="tinyMCE"in t&&"function"==typeof t.tinyMCE.init,o=l.fn.is,r=0,f=function(){var t=(new Date).getTime();t-r<250&&l(this).trigger(i),r=t},u=function(t){if(13==t.keyCode&&t.data.closeOnEnter)h.editable("close");else if(t.data.toggleFontSize&&t.metaKey&&(38==t.keyCode||40==t.keyCode)){var e=parseInt(c.css("font-size"),10);return e+=40==t.keyCode?-1:1,c.css("font-size",e+"px"),!1}},y=function(){c[0].scrollHeight!==parseInt(c.attr("data-scroll"),10)&&(c.css("height",c[0].scrollHeight+"px"),c.attr("data-scroll",c[0].scrollHeight))},b=function(t,e,i){t.removeAttr(a),0==e.length&&i?(t.html(i),t.attr(g,"empty")):(t.html(e),t.removeAttr(g)),c.remove()},m=function(s,o){if(!s.is(":editing")){(h=s).attr(a,"1"),s.is(":empty")&&(s.removeAttr(g),s.html(""));var r=l.trim(s.html()),i=s.css("font-size"),t=s.height(),e="width: 96%; padding:0; margin:0; border:0; background:none;font-family: "+s.css("font-family")+"; font-size: "+s.css("font-size")+";font-weight: "+s.css("font-weight")+";";if(o.lineBreaks&&(r=r.replace(/<br( |)(|\/)>/g,"\n")),c=l("<textarea></textarea>"),s.text(""),null!==navigator.userAgent.match(/webkit/i)&&(e=document.defaultView.getComputedStyle(s.get(0),"").cssText),e+="position: static",!1!==o.tinyMCE){var n="editable-area-"+(new Date).getTime();c.val(r).appendTo(s).attr("id",n),"object"!=typeof o.tinyMCE&&(o.tinyMCE={}),o.tinyMCE.mode="exact",o.tinyMCE.elements=n,o.tinyMCE.width=s.innerWidth(),o.tinyMCE.height=s.height()+200,o.tinyMCE.theme_advanced_resize_vertical=!0,o.tinyMCE.setup=function(t){t.onInit.add(function(e,t){var i=e.getWin(),n=!1,a=function(){var t=l(e.getDoc()).find("body").html();l(t).get(0).nodeName==s.get(0).nodeName&&(t=l(t).html()),b(s,t,o.emptyMessage),e.remove(),c=!1,d.unbind("click",a),h=!1,"function"==typeof o.callback&&o.callback({content:!(t==r||!n)&&t,fontSize:!1,$el:s})};setTimeout(function(){d.bind("click",a)},500),(c=l("<textarea></textarea>")).bind("blur",a),i.onkeydown=function(){n=!0},i.focus()})},tinyMCE.init(o.tinyMCE)}else(o.toggleFontSize||o.closeOnEnter)&&d.bind("keydown",o,u),d.bind("keyup",y),c.val(r).blur(function(){h=!1;var t=l.trim(c.val()),e=c.css("font-size");o.lineBreaks&&(t=t.replace(new RegExp("\n","g"),"<br />")),b(s,t,o.emptyMessage),e!=i&&s.css("font-size",e),d.unbind("keydown",u),d.unbind("keyup",y),"function"==typeof o.callback&&o.callback({content:t!=r&&t,fontSize:e!=i&&e,$el:s})}).attr("style",e).appendTo(s).css({margin:0,padding:0,height:t+"px",overflow:"hidden"}).focus().get(0).select(),y();s.trigger("edit",[c])}},p=function(t){return!1!==h&&h.editable("close"),m(l(this),t.data),!1};l.fn.editable=function(t){if("string"==typeof t)if(this.is(":editable"))switch(t){case"open":this.is(":editing")||this.trigger(this.attr(e));break;case"close":this.is(":editing")&&c.trigger("blur");break;case"destroy":this.is(":editing")&&c.trigger("blur"),this.unbind(this.attr(e)),this.removeAttr(e);break;default:console.warn('Unknown command "'+t+'" for jquery.editable')}else console.error("Calling .editable() on an element that is not editable, call .editable() first");else this.is(":editable")&&(console.warn('Making an already editable element editable, call .editable("destroy") first'),this.editable("destroy")),!1===(t=l.extend({event:"dblclick",touch:!0,lineBreaks:!0,toggleFontSize:!0,closeOnEnter:!1,emptyMessage:!1,tinyMCE:!1},t)).tinyMCE||s||(console.warn("Trying to use tinyMCE as editor but id does not seem to be installed"),t.tinyMCE=!1),n&&t.touch?(t.event=i,this.unbind("touchend",f),this.bind("touchend",f)):t.event+=".textEditor",this.bind(t.event,t,p),this.attr(e,t.event),0==this.html().length&&t.emptyMessage?(this.html(t.emptyMessage),this.attr(g,"empty")):this.removeAttr(g);return this},l.fn.is=function(t){if("string"==typeof t&&0===t.indexOf(":")){if(":editable"==t)return void 0!==this.attr(e);if(":editing"==t)return void 0!==this.attr(a);if(":empty"==t)return void 0!==this.attr(g)}return o.apply(this,arguments)}}(jQuery,window);