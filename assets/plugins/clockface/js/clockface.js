!function(l){var n=function(t,e){this.$element=l(t),this.options=l.extend({},l.fn.clockface.defaults,e,this.$element.data()),this.init()};n.prototype={constructor:n,init:function(){this.$clockface=l(l.fn.clockface.template),this.$clockface.find(".l1 .cell, .left.cell").html('<div class="outer"></div><div class="inner"></div>'),this.$clockface.find(".l5 .cell, .right.cell").html('<div class="inner"></div><div class="outer"></div>'),this.$clockface.hide(),this.$outer=this.$clockface.find(".outer"),this.$inner=this.$clockface.find(".inner"),this.$ampm=this.$clockface.find(".ampm"),this.ampm=null,this.hour=null,this.minute=null,this.$ampm.click(l.proxy(this.clickAmPm,this)),this.$clockface.on("click",".cell",l.proxy(this.click,this)),this.parseFormat(),this.prepareRegexp(),this.ampmtext=this.is24?{am:"12-23",pm:"0-11"}:{am:"AM",pm:"PM"},this.isInline=this.$element.is("div"),this.isInline?this.$clockface.addClass("clockface-inline").appendTo(this.$element):(this.$clockface.addClass("dropdown-menu").appendTo("body"),"focus"===this.options.trigger&&this.$element.on("focus.clockface",l.proxy(function(t){this.show()},this)),l(document).off("click.clockface").on("click.clockface",l.proxy(function(t){l(t.target).closest(".clockface").length||l(".clockface-open").each(function(){this!==t.target&&l(this).clockface("hide")})},this))),this.fill("minute")},show:function(t){this.$clockface.is(":visible")||(this.isInline||(void 0===t&&(t=this.$element.val()),this.$element.addClass("clockface-open"),this.$element.on("keydown.clockface",l.proxy(this.keydown,this)),this.place(),l(window).on("resize.clockface",l.proxy(this.place,this))),this.$clockface.show(),this.setTime(t),this.$element.triggerHandler("shown.clockface",this.getTime(!0)))},hide:function(){this.$clockface.hide(),this.isInline||(this.$element.removeClass("clockface-open"),this.$element.off("keydown.clockface"),l(window).off("resize.clockface")),this.$element.triggerHandler("hidden.clockface",this.getTime(!0))},toggle:function(t){this.$clockface.is(":visible")?this.hide():this.show(t)},setTime:function(t){var e,i,s,c="am";void 0!==t?(t instanceof Date&&(i=t.getHours(),s=t.getMinutes()),"string"==typeof t&&t.length&&(24===(e=this.parseTime(t)).hour&&(e.hour=0),i=e.hour,s=e.minute,c=e.ampm),11<i&&i<24?(c="pm",!this.is24&&12<i&&(i-=12)):0<=i&&i<11&&(this.is24||0===i)&&(c="am"),this.setAmPm(c),this.setHour(i),this.setMinute(s)):null===this.ampm&&this.setAmPm("am")},setAmPm:function(t){t!==this.ampm&&(this.ampm="am"===t?"am":"pm",this.$ampm.text(this.ampmtext[this.ampm]),this.fill("hour"),this.highlight("hour"))},setHour:function(t){t=parseInt(t,10),((t=isNaN(t)?null:t)<0||23<t)&&(t=null),t!==this.hour&&(this.hour=t,this.highlight("hour"))},setMinute:function(t){t=parseInt(t,10),((t=isNaN(t)?null:t)<0||59<t)&&(t=null),t!==this.minute&&(this.minute=t,this.highlight("minute"))},highlight:function(t){var e,i=this.getValues(t),s="minute"===t?this.minute:this.hour,c="minute"===t?this.$outer:this.$inner;c.removeClass("active"),0<=(e=l.inArray(s,i))&&c.eq(e).addClass("active")},fill:function(t){var i=this.getValues(t),e="minute"===t?this.$outer:this.$inner,s="minute"===t;e.each(function(t){var e=i[t];s&&e<10&&(e="0"+e),l(this).text(e)})},getValues:function(t){var e=[11,0,1,10,2,9,3,8,4,7,6,5],i=e.slice();return"minute"===t?l.each(e,function(t,e){i[t]=5*e}):(this.is24||(i[1]=12),this.is24&&"pm"===this.ampm&&l.each(e,function(t,e){i[t]=e+12})),i},click:function(t){var e=l(t.target),i=e.hasClass("active")?null:e.text();e.hasClass("inner")?this.setHour(i):this.setMinute(i),this.isInline||this.$element.val(this.getTime()),this.$element.triggerHandler("pick.clockface",this.getTime(!0))},clickAmPm:function(t){t.preventDefault(),this.setAmPm("am"===this.ampm?"pm":"am"),this.isInline||this.is24||this.$element.val(this.getTime()),this.$element.triggerHandler("pick.clockface",this.getTime(!0))},place:function(){var t=parseInt(this.$element.parents().filter(function(){return"auto"!=l(this).css("z-index")}).first().css("z-index"),10)+10,e=this.$element.offset();this.$clockface.css({top:e.top+this.$element.outerHeight(),left:e.left,zIndex:t})},keydown:function(t){/^(9|27|13)$/.test(t.which)?this.hide():(clearTimeout(this.timer),this.timer=setTimeout(l.proxy(function(){this.setTime(this.$element.val())},this),500))},parseFormat:function(){var i=this.options.format,s="HH",c="mm";l.each(["HH","hh","H","h"],function(t,e){if(-1!==i.indexOf(e))return s=e,!1}),l.each(["mm","m"],function(t,e){if(-1!==i.indexOf(e))return c=e,!1}),this.is24=-1!==s.indexOf("H"),this.hFormat=s,this.mFormat=c},parseTime:function(t){var e,i=null,s=null,c="am",n=[];if(t=l.trim(t),this.regexpSep&&(n=t.match(this.regexpSep)),n&&n.length)i=n[1]?parseInt(n[1],10):null,s=n[2]?parseInt(n[2],10):null,c=n[3]&&"a"!==n[3].toLowerCase()?"pm":"am";else if((n=(t=t.split("").reverse().join("").replace(/\s/g,"")).match(this.regexpNoSep))&&n.length)switch(c=n[1]&&"a"!==n[1].toLowerCase()?"pm":"am",(e=n[2].split("").reverse().join("")).length){case 1:i=parseInt(e,10);break;case 2:24<(i=parseInt(e,10))&&(i=parseInt(e[0],10),s=parseInt(e[1],10));break;case 3:i=parseInt(e[0],10),59<(s=parseInt(e[1]+e[2],10))&&(i=parseInt(e[0]+e[1],10),s=parseInt(e[2],10),24<i&&(s=i=null));break;case 4:24<(i=parseInt(e[0]+e[1],10))&&(i=null),59<(s=parseInt(e[2]+e[3],10))&&(s=null)}return{hour:i,minute:s,ampm:c}},prepareRegexp:function(){var t=this.options.format.match(/h\s*([^hm]?)\s*m/i);t&&t.length&&(t=t[1]),this.separator=t,this.regexpSep=this.separator&&this.separator.length?new RegExp("(\\d\\d?)\\s*\\"+this.separator+"\\s*(\\d?\\d?)\\s*(a|p)?","i"):null,this.regexpNoSep=new RegExp("(a|p)?\\s*(\\d{1,4})","i")},getTime:function(t){if(!0===t)return{hour:this.hour,minute:this.minute,ampm:this.ampm};var e=null!==this.hour?this.hour+"":"",i=null!==this.minute?this.minute+"":"",s=this.options.format;return e.length||i.length?(1<this.hFormat.length&&1===e.length&&(e="0"+e),1<this.mFormat.length&&1===i.length&&(i="0"+i),!i.length&&this.separator&&(s=s.replace(this.separator,"")),s=s.replace(this.hFormat,e).replace(this.mFormat,i),this.is24||(s=-1!==s.indexOf("A")?s.replace("A",this.ampm.toUpperCase()):s.replace("a",this.ampm)),s):""},destroy:function(){this.hide(),this.$clockface.remove(),this.isInline||"focus"!==this.options.trigger||this.$element.off("focus.clockface")}},l.fn.clockface=function(s){var t,c=Array.apply(null,arguments);return c.shift(),"getTime"===s&&this.length&&(t=this.eq(0).data("clockface"))?t.getTime.apply(t,c):this.each(function(){var t=l(this),e=t.data("clockface"),i="object"==typeof s&&s;e||t.data("clockface",e=new n(this,i)),"string"==typeof s&&"function"==typeof e[s]&&e[s].apply(e,c)})},l.fn.clockface.defaults={format:"H:mm",trigger:"focus"},l.fn.clockface.template='<div class="clockface"><div class="l1"><div class="cell"></div><div class="cell"></div><div class="cell"></div></div><div class="l2"><div class="cell left"></div><div class="cell right"></div></div><div class="l3"><div class="cell left"></div><div class="cell right"></div><div class="center"><a href="#" class="ampm"></a></div></div><div class="l4"><div class="cell left"></div><div class="cell right"></div></div><div class="l5"><div class="cell"></div><div class="cell"></div><div class="cell"></div></div></div>'}(window.jQuery);