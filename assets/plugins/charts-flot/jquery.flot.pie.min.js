!function(P){var A={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,shadow:{left:5,top:15,alpha:.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(e,i){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+i.color+";'>"+e+"<br/>"+Math.round(i.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}};P.plot.plugins.push({init:function(h){function r(e){p||(p=!0,s=e.getCanvas(),w=P(s).parent(),A=e.getOptions(),e.setData(function(e){for(var i=0,s=0,t=0,r=A.series.pie.combine.color,a=[],l=0;l<e.length;++l){var n=e[l].data;P.isArray(n)&&1==n.length&&(n=n[0]),P.isArray(n)?n[1]=!isNaN(parseFloat(n[1]))&&isFinite(n[1])?+n[1]:0:n=!isNaN(parseFloat(n))&&isFinite(n)?[1,+n]:[1,0],e[l].data=[n]}for(var l=0;l<e.length;++l)i+=e[l].data[0][1];for(var l=0;l<e.length;++l){var n=e[l].data[0][1];n/i<=A.series.pie.combine.threshold&&(s+=n,t++,r||(r=e[l].color))}for(var l=0;l<e.length;++l){var n=e[l].data[0][1];(t<2||n/i>A.series.pie.combine.threshold)&&a.push({data:[[1,n]],color:e[l].color,label:e[l].label,angle:2*n*Math.PI/i,percent:n/(i/100)})}return 1<t&&a.push({data:[[1,s]],color:r,label:A.series.pie.combine.label,angle:2*s*Math.PI/i,percent:s/(i/100)}),a}(e.getData())))}function o(e){if(0<A.series.pie.innerRadius){e.save();var i=1<A.series.pie.innerRadius?A.series.pie.innerRadius:d*A.series.pie.innerRadius;e.globalCompositeOperation="destination-out",e.beginPath(),e.fillStyle=A.series.pie.stroke.color,e.arc(0,0,i,0,2*Math.PI,!1),e.fill(),e.closePath(),e.restore(),e.save(),e.beginPath(),e.strokeStyle=A.series.pie.stroke.color,e.arc(0,0,i,0,2*Math.PI,!1),e.stroke(),e.closePath(),e.restore()}}function g(e,i){for(var s=!1,t=-1,r=e.length,a=r-1;++t<r;a=t)(e[t][1]<=i[1]&&i[1]<e[a][1]||e[a][1]<=i[1]&&i[1]<e[t][1])&&i[0]<(e[a][0]-e[t][0])*(i[1]-e[t][1])/(e[a][1]-e[t][1])+e[t][0]&&(s=!s);return s}function t(e){i("plothover",e)}function a(e){i("plotclick",e)}function i(e,i){var s,t,r,a=h.offset(),l=function(e,i){for(var s,t,r=h.getData(),a=h.getOptions(),l=1<a.series.pie.radius?a.series.pie.radius:d*a.series.pie.radius,n=0;n<r.length;++n){var o=r[n];if(o.pie.show){if(f.save(),f.beginPath(),f.moveTo(0,0),f.arc(0,0,l,o.startAngle,o.startAngle+o.angle/2,!1),f.arc(0,0,l,o.startAngle+o.angle/2,o.startAngle+o.angle,!1),f.closePath(),s=e-k,t=i-M,f.isPointInPath){if(f.isPointInPath(e-k,i-M))return f.restore(),{datapoint:[o.percent,o.data],dataIndex:0,series:o,seriesIndex:n}}else if(g([[0,0],[l*Math.cos(o.startAngle),l*Math.sin(o.startAngle)],[l*Math.cos(o.startAngle+o.angle/4),l*Math.sin(o.startAngle+o.angle/4)],[l*Math.cos(o.startAngle+o.angle/2),l*Math.sin(o.startAngle+o.angle/2)],[l*Math.cos(o.startAngle+o.angle/1.5),l*Math.sin(o.startAngle+o.angle/1.5)],[l*Math.cos(o.startAngle+o.angle),l*Math.sin(o.startAngle+o.angle)]],[s,t]))return f.restore(),{datapoint:[o.percent,o.data],dataIndex:0,series:o,seriesIndex:n};f.restore()}}return null}(parseInt(i.pageX-a.left),parseInt(i.pageY-a.top));if(A.grid.autoHighlight)for(var n=0;n<v.length;++n){var o=v[n];o.auto!=e||l&&o.series==l.series||c(o.series)}l&&(s=l.series,t=e,-1==(r=u(s))?(v.push({series:s,auto:t}),h.triggerRedrawOverlay()):t||(v[r].auto=!1));var p={pageX:i.pageX,pageY:i.pageY};w.trigger(e,[p,l])}function c(e){null==e&&(v=[],h.triggerRedrawOverlay());var i=u(e);-1!=i&&(v.splice(i,1),h.triggerRedrawOverlay())}function u(e){for(var i=0;i<v.length;++i)if(v[i].series==e)return i;return-1}var s=null,w=null,d=null,k=null,M=null,p=!1,f=null,v=[];h.hooks.processOptions.push(function(e,i){i.series.pie.show&&(i.grid.show=!1,"auto"==i.series.pie.label.show&&(i.series.pie.label.show=!i.legend.show),"auto"==i.series.pie.radius&&(i.series.pie.radius=i.series.pie.label.show?.75:1),1<i.series.pie.tilt?i.series.pie.tilt=1:i.series.pie.tilt<0&&(i.series.pie.tilt=0))}),h.hooks.bindEvents.push(function(e,i){var s=e.getOptions();s.series.pie.show&&(s.grid.hoverable&&i.unbind("mousemove").mousemove(t),s.grid.clickable&&i.unbind("click").click(a))}),h.hooks.processDatapoints.push(function(e,i,s,t){e.getOptions().series.pie.show&&r(e)}),h.hooks.drawOverlay.push(function(e,i){e.getOptions().series.pie.show&&function(e,i){var s,t=e.getOptions(),r=1<t.series.pie.radius?t.series.pie.radius:d*t.series.pie.radius;i.save(),i.translate(k,M),i.scale(1,t.series.pie.tilt);for(var a=0;a<v.length;++a)(s=v[a].series).angle<=0||isNaN(s.angle)||(i.fillStyle="rgba(255, 255, 255, "+t.series.pie.highlight.opacity+")",i.beginPath(),1e-9<Math.abs(s.angle-2*Math.PI)&&i.moveTo(0,0),i.arc(0,0,r,s.startAngle,s.startAngle+s.angle/2,!1),i.arc(0,0,r,s.startAngle+s.angle/2,s.startAngle+s.angle,!1),i.closePath(),i.fill());o(i),i.restore()}(e,i)}),h.hooks.draw.push(function(e,i){e.getOptions().series.pie.show&&function(e,i){function s(){f.clearRect(0,0,v,b),w.children().filter(".pieLabel, .pieLabelBackground").remove()}function t(){var e=A.series.pie.shadow.left,i=A.series.pie.shadow.top,s=A.series.pie.shadow.alpha,t=1<A.series.pie.radius?A.series.pie.radius:d*A.series.pie.radius;if(!(v/2-e<=t||t*A.series.pie.tilt>=b/2-i||t<=10)){f.save(),f.translate(e,i),f.globalAlpha=s,f.fillStyle="#000",f.translate(k,M),f.scale(1,A.series.pie.tilt);for(var r=1;r<=10;r++)f.beginPath(),f.arc(0,0,t,0,2*Math.PI,!1),f.fill(),t-=r;f.restore()}}function r(){function e(e,i,s){e<=0||isNaN(e)||(s?f.fillStyle=i:(f.strokeStyle=i,f.lineJoin="round"),f.beginPath(),1e-9<Math.abs(e-2*Math.PI)&&f.moveTo(0,0),f.arc(0,0,r,a,a+e/2,!1),f.arc(0,0,r,a+e/2,a+e,!1),f.closePath(),a+=e,s?f.fill():f.stroke())}var t=Math.PI*A.series.pie.startAngle,r=1<A.series.pie.radius?A.series.pie.radius:d*A.series.pie.radius;f.save(),f.translate(k,M),f.scale(1,A.series.pie.tilt),f.save();for(var a=t,i=0;i<l.length;++i)l[i].startAngle=a,e(l[i].angle,l[i].color,!0);if(f.restore(),0<A.series.pie.stroke.width){for(f.save(),f.lineWidth=A.series.pie.stroke.width,a=t,i=0;i<l.length;++i)e(l[i].angle,A.series.pie.stroke.color,!1);f.restore()}return o(f),f.restore(),!A.series.pie.label.show||function(){function e(e,i,s){if(0==e.data[0][1])return!0;var t,r=A.legend.labelFormatter,a=A.series.pie.label.formatter;t=r?r(e.label,e):e.label,a&&(t=a(t,e));var l=(i+e.angle+i)/2,n=k+Math.round(Math.cos(l)*f),o=M+Math.round(Math.sin(l)*f)*A.series.pie.tilt,p="<span class='pieLabel' id='pieLabel"+s+"' style='position:absolute;top:"+o+"px;left:"+n+"px;'>"+t+"</span>";w.append(p);var h=w.children("#pieLabel"+s),g=o-h.height()/2,c=n-h.width()/2;if(h.css("top",g),h.css("left",c),0<0-g||0<0-c||b-(g+h.height())<0||v-(c+h.width())<0)return!1;if(0!=A.series.pie.label.background.opacity){var u=A.series.pie.label.background.color;null==u&&(u=e.color);var d="top:"+g+"px;left:"+c+"px;";P("<div class='pieLabelBackground' style='position:absolute;width:"+h.width()+"px;height:"+h.height()+"px;"+d+"background-color:"+u+";'></div>").css("opacity",A.series.pie.label.background.opacity).insertBefore(h)}return!0}for(var i=t,f=1<A.series.pie.label.radius?A.series.pie.label.radius:d*A.series.pie.label.radius,s=0;s<l.length;++s){if(l[s].percent>=100*A.series.pie.label.threshold&&!e(l[s],i,s))return!1;i+=l[s].angle}return!0}()}if(w){var v=e.getPlaceholder().width(),b=e.getPlaceholder().height(),a=w.children().filter(".legend").children().width()||0;f=i,p=!1,d=Math.min(v,b/A.series.pie.tilt)/2,M=b/2+A.series.pie.offset.top,k=v/2,"auto"==A.series.pie.offset.left?A.legend.position.match("w")?k+=a/2:k-=a/2:k+=A.series.pie.offset.left,k<d?k=d:v-d<k&&(k=v-d);for(var l=e.getData(),n=0;0<n&&(d*=.95),n+=1,s(),A.series.pie.tilt<=.8&&t(),!r()&&n<10;);10<=n&&(s(),w.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>")),e.setSeries&&e.insertLegend&&(e.setSeries(l),e.insertLegend())}}(e,i)})},options:A,name:"pie",version:"1.1"})}(jQuery);