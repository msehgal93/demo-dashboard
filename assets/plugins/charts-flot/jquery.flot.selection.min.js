!function(m){m.plot.plugins.push({init:function(a){function o(e){f.active&&(c(e),a.getPlaceholder().trigger("plotselecting",[t()]))}function n(e){1==e.which&&(document.body.focus(),void 0!==document.onselectstart&&null==g.onselectstart&&(g.onselectstart=document.onselectstart,document.onselectstart=function(){return!1}),void 0!==document.ondrag&&null==g.ondrag&&(g.ondrag=document.ondrag,document.ondrag=function(){return!1}),r(f.first,e),f.active=!0,h=function(e){var t;t=e,h=null,void 0!==document.onselectstart&&(document.onselectstart=g.onselectstart),void 0!==document.ondrag&&(document.ondrag=g.ondrag),f.active=!1,c(t),u()?i():(a.getPlaceholder().trigger("plotunselected",[]),a.getPlaceholder().trigger("plotselecting",[null]))},m(document).one("mouseup",h))}function t(){if(!u())return null;if(!f.show)return null;var i={},s=f.first,r=f.second;return m.each(a.getAxes(),function(e,t){if(t.used){var o=t.c2p(s[t.direction]),n=t.c2p(r[t.direction]);i[e]={from:Math.min(o,n),to:Math.max(o,n)}}}),i}function i(){var e=t();a.getPlaceholder().trigger("plotselected",[e]),e.xaxis&&e.yaxis&&a.getPlaceholder().trigger("selected",[{x1:e.xaxis.from,y1:e.yaxis.from,x2:e.xaxis.to,y2:e.yaxis.to}])}function s(e,t,o){return t<e?e:o<t?o:t}function r(e,t){var o=a.getOptions(),n=a.getPlaceholder().offset(),i=a.getPlotOffset();e.x=s(0,t.pageX-n.left-i.left,a.width()),e.y=s(0,t.pageY-n.top-i.top,a.height()),"y"==o.selection.mode&&(e.x=e==f.first?0:a.width()),"x"==o.selection.mode&&(e.y=e==f.first?0:a.height())}function c(e){null!=e.pageX&&(r(f.second,e),u()?(f.show=!0,a.triggerRedrawOverlay()):l(!0))}function l(e){f.show&&(f.show=!1,a.triggerRedrawOverlay(),e||a.getPlaceholder().trigger("plotunselected",[]))}function d(e,t){var o,n,i,s,r=a.getAxes();for(var c in r)if((o=r[c]).direction==t&&(e[s=t+o.n+"axis"]||1!=o.n||(s=t+"axis"),e[s])){n=e[s].from,i=e[s].to;break}if(e[s]||(o="x"==t?a.getXAxes()[0]:a.getYAxes()[0],n=e[t+"1"],i=e[t+"2"]),null!=n&&null!=i&&i<n){var l=n;n=i,i=l}return{from:n,to:i,axis:o}}function u(){var e=a.getOptions().selection.minSize;return Math.abs(f.second.x-f.first.x)>=e&&Math.abs(f.second.y-f.first.y)>=e}var f={first:{x:-1,y:-1},second:{x:-1,y:-1},show:!1,active:!1},g={},h=null;a.clearSelection=l,a.setSelection=function(e,t){var o,n=a.getOptions();"y"==n.selection.mode?(f.first.x=0,f.second.x=a.width()):(o=d(e,"x"),f.first.x=o.axis.p2c(o.from),f.second.x=o.axis.p2c(o.to)),"x"==n.selection.mode?(f.first.y=0,f.second.y=a.height()):(o=d(e,"y"),f.first.y=o.axis.p2c(o.from),f.second.y=o.axis.p2c(o.to)),f.show=!0,a.triggerRedrawOverlay(),!t&&u()&&i()},a.getSelection=t,a.hooks.bindEvents.push(function(e,t){null!=e.getOptions().selection.mode&&(t.mousemove(o),t.mousedown(n))}),a.hooks.drawOverlay.push(function(e,t){if(f.show&&u()){var o=e.getPlotOffset(),n=e.getOptions();t.save(),t.translate(o.left,o.top);var i=m.color.parse(n.selection.color);t.strokeStyle=i.scale("a",.8).toString(),t.lineWidth=1,t.lineJoin=n.selection.shape,t.fillStyle=i.scale("a",.4).toString();var s=Math.min(f.first.x,f.second.x)+.5,r=Math.min(f.first.y,f.second.y)+.5,c=Math.abs(f.second.x-f.first.x)-1,l=Math.abs(f.second.y-f.first.y)-1;t.fillRect(s,r,c,l),t.strokeRect(s,r,c,l),t.restore()}}),a.hooks.shutdown.push(function(e,t){t.unbind("mousemove",o),t.unbind("mousedown",n),h&&m(document).unbind("mouseup",h)})},options:{selection:{mode:null,color:"#e8cfac",shape:"round",minSize:5}},name:"selection",version:"1.1"})}(jQuery);