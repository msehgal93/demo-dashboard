!function(b){"use strict";var i=function(t,e){this.$ns="bootstrap-markdown",this.$element=b(t),this.$editable={el:null,type:null,attrKeys:[],attrValues:[],content:null},this.$options=b.extend(!0,{},b.fn.markdown.defaults,e),this.$oldContent=null,this.$isPreview=!1,this.$editor=null,this.$textarea=null,this.$handler=[],this.$callback=[],this.$nextTab=[],this.showEditor()};i.prototype={constructor:i,__alterButtons:function(n,a){var t=this.$handler,i="all"==n,r=this;b.each(t,function(t,e){0==(!i&&e.indexOf(n)<0)&&a(r.$editor.find('button[data-handler="'+e+'"]'))})},__buildButtons:function(t,e){var n,a=this.$ns,i=this.$handler,r=this.$callback;for(n=0;n<t.length;n++){var s,o=t[n];for(s=0;s<o.length;s++){var l,c=o[s].data,d=b("<div/>",{class:"btn-group"});for(l=0;l<c.length;l++){var h=c[l],u="",f=a+"-"+h.name,p=h.btnText?h.btnText:"",v=h.btnClass?h.btnClass:"btn",m=h.tabIndex?h.tabIndex:"-1";1==h.toggle&&(u=' data-toggle="button"'),d.append('<button class="'+v+' btn-small" title="'+h.title+'" tabindex="'+m+'" data-provider="'+a+'" data-handler="'+f+'"'+u+'><i class="'+h.icon+'"></i> '+p+"</button>"),i.push(f),r.push(h.callback)}e.append(d)}}return e},__setListener:function(){var t=void 0!==this.$textarea.attr("rows"),e=5<this.$textarea.val().split("\n").length?this.$textarea.val().split("\n").length:"5",n=t?this.$textarea.attr("rows"):e;this.$textarea.attr("rows",n),this.$textarea.css("resize","none"),this.$textarea.on("focus",b.proxy(this.focus,this)).on("keypress",b.proxy(this.keypress,this)).on("keyup",b.proxy(this.keyup,this)),this.eventSupported("keydown")&&this.$textarea.on("keydown",b.proxy(this.keydown,this)),this.$textarea.data("markdown",this)},__handle:function(t){var e=b(t.currentTarget),n=this.$handler,a=this.$callback,i=e.attr("data-handler"),r=a[n.indexOf(i)];b(t.currentTarget).focus(),r(this),i.indexOf("cmdSave")<0&&this.$textarea.focus(),t.preventDefault()},showEditor:function(){var t,e=this,n=this.$ns,a=this.$element,i=(a.css("height"),a.css("width"),this.$editable),r=this.$handler,s=this.$callback,o=this.$options,l=b("<div/>",{class:"md-editor",click:function(){e.focus()}});if(null==this.$editor){var c=b("<div/>",{class:"md-header"});if(0<o.buttons.length&&(c=this.__buildButtons(o.buttons,c)),0<o.additionalButtons.length&&(c=this.__buildButtons(o.additionalButtons,c)),l.append(c),a.is("textarea"))a.before(l),(t=a).addClass("md-input"),l.append(t);else{var d="function"==typeof toMarkdown?toMarkdown(a.html()):a.html(),h=b.trim(d);t=b("<textarea/>",{class:"md-input",val:h}),l.append(t),i.el=a,i.type=a.prop("tagName").toLowerCase(),i.content=a.html(),b(a[0].attributes).each(function(){i.attrKeys.push(this.nodeName),i.attrValues.push(this.nodeValue)}),a.replaceWith(l)}if(o.savable){var u=b("<div/>",{class:"md-footer"}),f="cmdSave";r.push(f),s.push(o.onSave),u.append('<button class="btn btn-success" data-provider="'+n+'" data-handler="'+f+'"><i class="fa fa-check"></i> Save</button>'),l.append(u)}b.each(["height","width"],function(t,e){"inherit"!=o[e]&&(jQuery.isNumeric(o[e])?l.css(e,o[e]+"px"):l.addClass(o[e]))}),this.$editor=l,this.$textarea=t,this.$editable=i,this.$oldContent=this.getContent(),this.__setListener(),this.$editor.attr("id",(new Date).getTime()),this.$editor.on("click",'[data-provider="bootstrap-markdown"]',b.proxy(this.__handle,this))}else this.$editor.show();return o.autofocus&&(this.$textarea.focus(),this.$editor.addClass("active")),o.onShow(this),this},showPreview:function(){var t,e=this.$options.onPreview(this),n=this.$textarea,a=n.next(),i=b("<div/>",{class:"md-preview","data-provider":"markdown-preview"});return this.$isPreview=!0,this.disableButtons("all").enableButtons("cmdPreview"),t="string"==typeof e?e:"object"==typeof markdown?markdown.toHTML(n.val()):n.val(),i.html(t),a&&"md-footer"==a.attr("class")?i.insertBefore(a):n.parent().append(i),n.hide(),i.data("markdown",this),this},hidePreview:function(){return this.$isPreview=!1,this.$editor.find('div[data-provider="markdown-preview"]').remove(),this.enableButtons("all"),this.$textarea.show(),this.__setListener(),this},isDirty:function(){return this.$oldContent!=this.getContent()},getContent:function(){return this.$textarea.val()},setContent:function(t){return this.$textarea.val(t),this},findSelection:function(t){var e;if(0<=(e=this.getContent().indexOf(t))&&0<t.length){var n,a=this.getSelection();return this.setSelection(e,e+t.length),n=this.getSelection(),this.setSelection(a.start,a.end),n}return null},getSelection:function(){var e=this.$textarea[0];return("selectionStart"in e&&function(){var t=e.selectionEnd-e.selectionStart;return{start:e.selectionStart,end:e.selectionEnd,length:t,text:e.value.substr(e.selectionStart,t)}}||function(){return null})()},setSelection:function(t,e){var n=this.$textarea[0];return("selectionStart"in n&&function(){n.selectionStart=t,n.selectionEnd=e}||function(){return null})()},replaceSelection:function(t){var e=this.$textarea[0];return("selectionStart"in e&&function(){return e.value=e.value.substr(0,e.selectionStart)+t+e.value.substr(e.selectionEnd,e.value.length),e.selectionStart=e.value.length,this}||function(){return e.value+=t,jQuery(e)})()},getNextTab:function(){if(0==this.$nextTab.length)return null;var t,e=this.$nextTab.shift();return"function"==typeof e?t=e():"object"==typeof e&&0<e.length&&(t=e),t},setNextTab:function(t,e){if("string"==typeof t){var n=this;this.$nextTab.push(function(){return n.findSelection(t)})}else if("numeric"==typeof t&&"numeric"==typeof e){var a=this.getSelection();this.setSelection(t,e),this.$nextTab.push(this.getSelection()),this.setSelection(a.start,a.end)}},enableButtons:function(t){return this.__alterButtons(t,function(t){t.removeAttr("disabled")}),this},disableButtons:function(t){return this.__alterButtons(t,function(t){t.attr("disabled","disabled")}),this},eventSupported:function(t){var e=t in this.$element;return e||(this.$element.setAttribute(t,"return;"),e="function"==typeof this.$element[t]),e},keydown:function(t){this.suppressKeyPressRepeat=~b.inArray(t.keyCode,[40,38,9,13,27]),this.keyup(t)},keypress:function(t){this.suppressKeyPressRepeat||this.keyup(t)},keyup:function(t){var e=!1;switch(t.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:var n;if(null!=(n=this.getNextTab())){var a=this;setTimeout(function(){a.setSelection(n.start,n.end)},500),e=!0}else{var i=this.getSelection();e=(i.start!=i.end||i.end!=this.getContent().length)&&(this.setSelection(this.getContent().length,this.getContent().length),!0)}break;case 13:case 27:e=!1;break;default:e=!1}e&&(t.stopPropagation(),t.preventDefault())},focus:function(t){this.$options.hideable;var e=this.$editor;return e.addClass("active"),b(document).find(".md-editor").each(function(){var t;b(this).attr("id")!=e.attr("id")&&(null==(t=b(this).find("textarea").data("markdown"))&&(t=b(this).find('div[data-provider="markdown-preview"]').data("markdown")),t&&t.blur())}),this},blur:function(t){var e=this.$options,n=e.hideable,a=this.$editor,i=this.$editable;if(a.hasClass("active")||0==this.$element.parent().length){if(a.removeClass("active"),n)if(null!=i.el){var r=b("<"+i.type+"/>"),s=this.getContent(),o="object"==typeof markdown?markdown.toHTML(s):s;b(i.attrKeys).each(function(t,e){r.attr(i.attrKeys[t],i.attrValues[t])}),r.html(o),a.replaceWith(r)}else a.hide();e.onBlur(this)}return this}};var t=b.fn.markdown;b.fn.markdown=function(a){return this.each(function(){var t=b(this),e=t.data("markdown"),n="object"==typeof a&&a;e||t.data("markdown",e=new i(this,n))})},b.fn.markdown.defaults={autofocus:!1,hideable:!1,savable:!1,width:"inherit",height:"inherit",buttons:[[{name:"groupFont",data:[{name:"cmdBold",title:"Bold",icon:"fa fa-bold",callback:function(t){var e,n,a=t.getSelection(),i=t.getContent();e=0==a.length?"strong text":a.text,n="**"==i.substr(a.start-2,2)&&"**"==i.substr(a.end,2)?(t.setSelection(a.start-2,a.end+2),t.replaceSelection(e),a.start-2):(t.replaceSelection("**"+e+"**"),a.start+2),t.setSelection(n,n+e.length)}},{name:"cmdItalic",title:"Italic",icon:"fa fa-italic",callback:function(t){var e,n,a=t.getSelection(),i=t.getContent();e=0==a.length?"emphasized text":a.text,n="*"==i.substr(a.start-1,1)&&"*"==i.substr(a.end,1)?(t.setSelection(a.start-1,a.end+1),t.replaceSelection(e),a.start-1):(t.replaceSelection("*"+e+"*"),a.start+1),t.setSelection(n,n+e.length)}},{name:"cmdHeading",title:"Heading",icon:"fa fa-font",callback:function(t){var e,n,a,i,r=t.getSelection(),s=t.getContent();e=0==r.length?"heading text":r.text,a=4,n="### "==s.substr(r.start-a,a)||(a=3,"###"==s.substr(r.start-a,a))?(t.setSelection(r.start-a,r.end),t.replaceSelection(e),r.start-a):(i=s.substr(r.start-1,1))&&"\n"!=i?(t.replaceSelection("\n\n### "+e+"\n"),r.start+6):(t.replaceSelection("### "+e+"\n"),r.start+4),t.setSelection(n,n+e.length)}}]},{name:"groupLink",data:[{name:"cmdUrl",title:"URL/Link",icon:"fa fa-globe",callback:function(t){var e,n,a,i=t.getSelection();t.getContent();e=0==i.length?"enter link description here":i.text,null!=(a=prompt("Insert Hyperlink","http://"))&&(t.replaceSelection("["+e+"]("+a+")"),n=i.start+1,t.setSelection(n,n+e.length))}},{name:"cmdImage",title:"Image",icon:"fa fa-picture-o",callback:function(t){var e,n,a,i=t.getSelection();t.getContent();e=0==i.length?"enter image description here":i.text,null!=(a=prompt("Insert Image Hyperlink","http://"))&&(t.replaceSelection("!["+e+"]("+a+' "enter image title here")'),n=i.start+2,t.setNextTab("enter image title here"),t.setSelection(n,n+e.length))}}]},{name:"groupMisc",data:[{name:"cmdList",title:"List",icon:"fa fa-list",callback:function(t){var e,n,a=t.getSelection();t.getContent();if(0==a.length)e="list text here",t.replaceSelection("- "+e),n=a.start+2;else if(a.text.indexOf("\n")<0)e=a.text,t.replaceSelection("- "+e),n=a.start+2;else{var i=[];e=(i=a.text.split("\n"))[0],b.each(i,function(t,e){i[t]="- "+e}),t.replaceSelection("\n\n"+i.join("\n")),n=a.start+4}t.setSelection(n,n+e.length)}}]},{name:"groupUtil",data:[{name:"cmdPreview",toggle:!0,title:"Preview",btnText:"Preview",btnClass:"btn btn-inverse",icon:"fa fa-search",callback:function(t){0==t.$isPreview?t.showPreview():t.hidePreview()}}]}]],additionalButtons:[],onShow:function(t){},onPreview:function(t){},onSave:function(t){},onBlur:function(t){}},b.fn.markdown.Constructor=i,b.fn.markdown.noConflict=function(){return b.fn.markdown=t,this};var e=function(t){var e=t;e.data("markdown")?e.data("markdown").showEditor():e.markdown(e.data())},n=function(t){var n,e=!1,a=b(t.currentTarget);"focusin"!=t.type&&"click"!=t.type||1!=a.length||"object"!=typeof a[0]||(n=a[0].activeElement,b(n).data("markdown")||(void 0===b(n).parent().parent().parent().attr("class")||b(n).parent().parent().parent().attr("class").indexOf("md-editor")<0?(void 0===b(n).parent().parent().attr("class")||b(n).parent().parent().attr("class").indexOf("md-editor")<0)&&(e=!0):e=!1),e&&b(document).find(".md-editor").each(function(){var t,e=b(n).parent();b(this).attr("id")!=e.attr("id")&&(null==(t=b(this).find("textarea").data("markdown"))&&(t=b(this).find('div[data-provider="markdown-preview"]').data("markdown")),t&&t.blur())}),t.stopPropagation())};b(document).on("click.markdown.data-api",'[data-provide="markdown-editable"]',function(t){e(b(this)),t.preventDefault()}).on("click",function(t){n(t)}).on("focusin",function(t){n(t)}).ready(function(){b('textarea[data-provide="markdown"]').each(function(){e(b(this))})})}(window.jQuery);