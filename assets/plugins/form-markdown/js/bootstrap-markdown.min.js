!function(g){function e(t){var n,e=!1,i=g(t.currentTarget);"focusin"!=t.type&&"click"!=t.type||1!=i.length||"object"!=typeof i[0]||(n=i[0].activeElement,g(n).data("markdown")||(void 0===g(n).parent().parent().parent().b("class")||g(n).parent().parent().parent().b("class").indexOf("md-editor")<0?(void 0===g(n).parent().parent().b("class")||g(n).parent().parent().b("class").indexOf("md-editor")<0)&&(e=!0):e=!1),e&&g(document).find(".md-editor").g(function(){var t,e=g(n).parent();g(this).b("id")!=e.b("id")&&(null==(t=g(this).find("textarea").data("markdown"))&&(t=g(this).find('div[data-provider="markdown-preview"]').data("markdown")),t&&t.blur())}),t.stopPropagation())}function n(t){t.data("markdown")?t.data("markdown").O():t.j(t.data())}function a(t,e){this.C="bootstrap-markdown",this.m=g(t),this.t={M:null,type:null,w:[],J:[],content:null},this.D=g.extend(!0,{},g.l.j.Q,e),this.u=!1,this.a=this.f=null,this.n=[],this.s=[],this.o=[],this.O()}a.prototype={F:function(n,i){var a="all"==n,s=this;g.g(this.n,function(t,e){0==(!a&&e.indexOf(n)<0)&&i(s.f.find('button[data-handler="'+e+'"]'))})},G:function(t,e){var n,i=this.C,a=this.n,s=this.s;for(n=0;n<t.length;n++){var r,o=t[n];for(r=0;r<o.length;r++){var h,d=o[r].data,c=g("<div/>",{class:"btn-group"});for(h=0;h<d.length;h++){var u=d[h],l="",f=i+"-"+u.name,p=u.L?u.L:"",v=u.K?u.K:"btn",m=u.tabIndex?u.tabIndex:"-1";1==u.toggle&&(l=' data-toggle="button"'),c.append('<button class="'+v+' btn-small" title="'+u.title+'" tabindex="'+m+'" data-provider="'+i+'" data-handler="'+f+'"'+l+'><i class="'+u.i+'"></i> '+p+"</button>"),a.push(f),s.push(u.h)}e.append(c)}}return e},H:function(){var t=void 0!==this.a.b("rows"),e=5<this.a.r().split("\n").length?this.a.r().split("\n").length:"5";t=t?this.a.b("rows"):e;this.a.b("rows",t),this.a.A("resize","none"),this.a.k("focus",g.q(this.focus,this)).k("keypress",g.q(this.Z,this)).k("keyup",g.q(this.B,this)),this.S("keydown")&&this.a.k("keydown",g.q(this.Y,this)),this.a.data("markdown",this)},P:function(t){var e=g(t.currentTarget),n=this.n,i=this.s;e=e.b("data-handler"),n=i[n.indexOf(e)];g(t.currentTarget).focus(),n(this),e.indexOf("cmdSave")<0&&this.a.focus(),t.preventDefault()},O:function(){var t,e=this,n=this.C,i=this.m;i.A("height"),i.A("width");var a=this.t,s=this.n,r=this.s,o=this.D,h=g("<div/>",{class:"md-editor",click:function(){e.focus()}});return null==this.f?(t=g("<div/>",{class:"md-header"}),0<o.buttons.length&&(t=this.G(o.buttons,t)),0<o.I.length&&(t=this.G(o.I,t)),h.append(t),i.ka("textarea")?(i.ha(h),(t=i).v("md-input"),h.append(t)):(t="function"==typeof toMarkdown?toMarkdown(i.p()):i.p(),t=g("<textarea/>",{class:"md-input",val:g.trim(t)}),h.append(t),a.M=i,a.type=i.ra("tagName").toLowerCase(),a.content=i.p(),g(i[0].attributes).g(function(){a.w.push(this.nodeName),a.J.push(this.nodeValue)}),i.aa(h)),o.ba&&(i=g("<div/>",{class:"md-footer"}),s.push("cmdSave"),r.push(o.$),i.append('<button class="btn btn-success" data-provider="'+n+'" data-handler="cmdSave"><i class="fa fa-check"></i> Save</button>'),h.append(i)),g.g(["height","width"],function(t,e){"inherit"!=o[e]&&(jQuery.la(o[e])?h.A(e,o[e]+"px"):h.v(o[e]))}),this.f=h,this.a=t,this.t=a,this.d(),this.H(),this.f.b("id",(new Date).getTime()),this.f.k("click",'[data-provider="bootstrap-markdown"]',g.q(this.P,this))):this.f.show(),o.autofocus&&(this.a.focus(),this.f.v("active")),this},da:function(){var t,e=this.a,n=e.next(),i=g("<div/>",{class:"md-preview","data-provider":"markdown-preview"});return this.u=!0,this.R("all").N("cmdPreview"),t="object"==typeof markdown?markdown.fa(e.r()):e.r(),i.p(t),n&&"md-footer"==n.b("class")?i.insertBefore(n):e.parent().append(i),e.V(),i.data("markdown",this),this},W:function(){return this.u=!1,this.f.find('div[data-provider="markdown-preview"]').remove(),this.N("all"),this.a.show(),this.H(),this},d:function(){return this.a.r()},T:function(t){var e;if(0<=(e=this.d().indexOf(t))&&0<t.length){var n=this.getSelection();return this.c(e,e+t.length),t=this.getSelection(),this.c(n.start,n.end),t}return null},getSelection:function(){var e=this.a[0];return("selectionStart"in e&&function(){var t=e.selectionEnd-e.selectionStart;return{start:e.selectionStart,end:e.selectionEnd,length:t,text:e.value.substr(e.selectionStart,t)}}||function(){return null})()},c:function(t,e){var n=this.a[0];return("selectionStart"in n&&function(){n.selectionStart=t,n.selectionEnd=e}||function(){return null})()},e:function(t){var e=this.a[0];return("selectionStart"in e&&function(){return e.value=e.value.substr(0,e.selectionStart)+t+e.value.substr(e.selectionEnd,e.value.length),e.selectionStart=e.value.length,this}||function(){return e.value+=t,jQuery(e)})()},U:function(){if(0==this.o.length)return null;var t,e=this.o.shift();return"function"==typeof e?t=e():"object"==typeof e&&0<e.length&&(t=e),t},ca:function(t,e){if("string"==typeof t){var n=this;this.o.push(function(){return n.T(t)})}else if("numeric"==typeof t&&"numeric"==typeof e){var i=this.getSelection();this.c(t,e),this.o.push(this.getSelection()),this.c(i.start,i.end)}},N:function(t){return this.F(t,function(t){t.ta("disabled")}),this},R:function(t){return this.F(t,function(t){t.b("disabled","disabled")}),this},S:function(t){var e=t in this.m;return e||(this.m.setAttribute(t,"return;"),e="function"==typeof this.m[t]),e},Y:function(t){this.ea=~g.ja(t.keyCode,[40,38,9,13,27]),this.B(t)},Z:function(t){this.ea||this.B(t)},B:function(t){var e=!1;switch(t.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:var n;if(null!=(n=this.U())){var i=this;setTimeout(function(){i.c(n.start,n.end)},500),e=!0}else e=((e=this.getSelection()).start!=e.end||e.end!=this.d().length)&&(this.c(this.d().length,this.d().length),!0);break;case 13:case 27:e=!1;break;default:e=!1}e&&(t.stopPropagation(),t.preventDefault())},focus:function(){var e=this.f;return e.v("active"),g(document).find(".md-editor").g(function(){var t;g(this).b("id")!=e.b("id")&&(null==(t=g(this).find("textarea").data("markdown"))&&(t=g(this).find('div[data-provider="markdown-preview"]').data("markdown")),t&&t.blur())}),this},blur:function(){var t=this.D.X,e=this.f,n=this.t;if((e.ia("active")||0==this.m.parent().length)&&(e.ua("active"),t))if(null!=n.M){var i=g("<"+n.type+"/>");t=this.d(),t="object"==typeof markdown?markdown.fa(t):t;g(n.w).g(function(t){i.b(n.w[t],n.J[t])}),i.p(t),e.aa(i)}else e.V();return this}};var t=g.l.j;g.l.j=function(i){return this.g(function(){var t=g(this),e=t.data("markdown"),n="object"==typeof i&&i;e||t.data("markdown",new a(this,n))})},g.l.j.Q={autofocus:!1,X:!1,ba:!1,width:"inherit",height:"inherit",buttons:[[{name:"groupFont",data:[{name:"cmdBold",title:"Bold",i:"fa fa-bold",h:function(t){var e,n;n=t.getSelection();var i=t.d();e=0==n.length?"strong text":n.text,n="**"==i.substr(n.start-2,2)&&"**"==i.substr(n.end,2)?(t.c(n.start-2,n.end+2),t.e(e),n.start-2):(t.e("**"+e+"**"),n.start+2),t.c(n,n+e.length)}},{name:"cmdItalic",title:"Italic",i:"fa fa-italic",h:function(t){var e,n;n=t.getSelection();var i=t.d();e=0==n.length?"emphasized text":n.text,n="*"==i.substr(n.start-1,1)&&"*"==i.substr(n.end,1)?(t.c(n.start-1,n.end+1),t.e(e),n.start-1):(t.e("*"+e+"*"),n.start+1),t.c(n,n+e.length)}},{name:"cmdHeading",title:"Heading",i:"fa fa-font",h:function(t){var e,n;n=t.getSelection();var i,a,s=t.d();e=0==n.length?"heading text":n.text,i=4,n="### "==s.substr(n.start-i,i)||(i=3,"###"==s.substr(n.start-i,i))?(t.c(n.start-i,n.end),t.e(e),n.start-i):(a=s.substr(n.start-1,1))&&"\n"!=a?(t.e("\n\n### "+e+"\n"),n.start+6):(t.e("### "+e+"\n"),n.start+4),t.c(n,n+e.length)}}]},{name:"groupLink",data:[{name:"cmdUrl",title:"URL/Link",i:"fa fa-globe",h:function(t){var e,n,i;n=t.getSelection(),t.d(),e=0==n.length?"enter link description here":n.text,null!=(i=prompt("Insert Hyperlink","http://"))&&(t.e("["+e+"]("+i+")"),n=n.start+1,t.c(n,n+e.length))}},{name:"cmdImage",title:"Image",i:"fa fa-picture-o",h:function(t){var e,n,i;n=t.getSelection(),t.d(),e=0==n.length?"enter image description here":n.text,null!=(i=prompt("Insert Image Hyperlink","http://"))&&(t.e("!["+e+"]("+i+' "enter image title here")'),n=n.start+2,t.ca("enter image title here"),t.c(n,n+e.length))}}]},{name:"groupMisc",data:[{name:"cmdList",title:"List",i:"fa fa-list",h:function(t){var e,n;if(n=t.getSelection(),t.d(),0==n.length)e="list text here",t.e("- "+e),n=n.start+2;else if(n.text.indexOf("\n")<0)e=n.text,t.e("- "+e),n=n.start+2;else{var i=[];e=(i=n.text.split("\n"))[0],g.g(i,function(t,e){i[t]="- "+e}),t.e("\n\n"+i.join("\n")),n=n.start+4}t.c(n,n+e.length)}}]},{name:"groupUtil",data:[{name:"cmdPreview",toggle:!0,title:"Preview",L:"Preview",K:"btn btn-inverse",i:"fa fa-search",h:function(t){0==t.u?t.da():t.W()}}]}]],I:[],qa:function(){},pa:function(){},$:function(){},oa:function(){}},g.l.j.ga=a,g.l.j.na=function(){return g.l.j=t,this},g(document).k("click.markdown.data-api",'[data-provide="markdown-editable"]',function(t){n(g(this)),t.preventDefault()}).k("click",function(t){e(t)}).k("focusin",function(t){e(t)}).sa(function(){g('textarea[data-provide="markdown"]').g(function(){n(g(this))})})}(window.ma);