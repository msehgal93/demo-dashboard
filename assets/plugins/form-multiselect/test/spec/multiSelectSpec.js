describe("multiSelect",function(){describe("init",function(){it("should be chainable",function(){select.multiSelect().addClass("chainable"),expect(select.hasClass("chainable")).toBeTruthy()}),describe("without options",function(){beforeEach(function(){select.multiSelect(),msContainer=select.next()}),it("should hide the original select",function(){expect(select.css("position")).toBe("absolute"),expect(select.css("left")).toBe("-9999px")}),it("should create a container",function(){expect(msContainer).toBe("div.ms-container")}),it("should create a selectable and a selection container",function(){expect(msContainer).toContain("div.ms-selectable, div.ms-selection")}),it("should create a list for both selectable and selection container",function(){expect(msContainer).toContain("div.ms-selectable ul.ms-list, div.ms-selection ul.ms-list")}),it("should populate the selectable list",function(){expect($(".ms-selectable ul.ms-list li").length).toEqual(10)}),it("should populate the selection list",function(){expect($(".ms-selectable ul.ms-list li").length).toEqual(10)})}),describe("with pre-selected options",function(){var l=[];beforeEach(function(){var e=select.children("option").first(),t=select.children("option").last();e.prop("selected",!0),t.prop("selected",!0),l.push(e.val(),t.val()),select.multiSelect(),msContainer=select.next()}),it("should select the pre-selected options",function(){$.each(l,function(e,t){expect($(".ms-selectable ul.ms-list li#"+sanitize(t)+"-selectable")).toBe(".ms-selected")}),expect($(".ms-selectable ul.ms-list li.ms-selected").length).toEqual(2)})})}),describe("optgroup",function(){var e,i,t;beforeEach(function(){$('<select id="multi-select-optgroup" multiple="multiple" name="testy[]"></select>').appendTo("body");for(var e=1;e<=10;e++){for(var t=$('<optgroup label="opgroup'+e+'"></optgroup>'),l=1;l<=10;l++){var c=l+10*e;$('<option value="value'+c+'">text'+c+"</option>").appendTo(t)}t.appendTo($("#multi-select-optgroup"))}i=$("#multi-select-optgroup")}),describe("init",function(){describe("with selectableOptgroup option set to false",function(){beforeEach(function(){i.multiSelect({selectableOptgroup:!1}),e=i.next(),t=e.find(".ms-selectable .ms-optgroup-label")}),it("sould display all optgroups",function(){expect(t.length).toEqual(10)}),it("should do nothing when clicking on optgroup",function(){t.first().trigger("click"),expect(i.val()).toBeNull()})}),describe("with selectableOptgroup option set to true",function(){beforeEach(function(){i.multiSelect({selectableOptgroup:!0}),e=i.next(),t=e.find(".ms-selectable .ms-optgroup-label")}),it("should select all nested options when clicking on optgroup",function(){t.first().trigger("click"),expect(i.val().length).toBe(10)})})})}),describe("select",function(){describe("multiple values (Array)",function(){var e=["value1","value2","value7"];beforeEach(function(){$("#multi-select").multiSelect(),$("#multi-select").multiSelect("select",e)}),it("should select corresponding option",function(){expect(select.val()).toEqual(e)})}),describe("single value (String)",function(){var e="value1";beforeEach(function(){$("#multi-select").multiSelect(),$("#multi-select").multiSelect("select",e)}),it("should select corresponding option",function(){expect(-1<$.inArray(e,select.val())).toBeTruthy()})}),describe("on click",function(){var e,t;beforeEach(function(){$("#multi-select").multiSelect(),e=$(".ms-selectable ul.ms-list li").first(),t=e.data("ms-value"),spyOnEvent(select,"change"),spyOnEvent(select,"focus"),e.trigger("click")}),it("should hide selected item",function(){expect(e).toBeHidden()}),it("should add the .ms-selected class to the selected item",function(){expect(e.hasClass("ms-selected")).toBeTruthy()}),it("should select corresponding option",function(){expect(select.find('option[value="'+t+'"]')).toBeSelected()}),it("should show the associated selected item",function(){expect($("#"+sanitize(t)+"-selection")).toBe(":visible")}),it("should trigger the original select change event",function(){expect("change").toHaveBeenTriggeredOn("#multi-select")}),afterEach(function(){select.multiSelect("deselect_all")})})}),describe("deselect",function(){describe("multiple values (Array)",function(){var e=["value1","value2","value7"],t=["value1","value2"];beforeEach(function(){$("#multi-select").multiSelect(),$("#multi-select").multiSelect("select",e),$("#multi-select").multiSelect("deselect",t)}),it("should select corresponding option",function(){expect(select.val()).toEqual(["value7"])})}),describe("single value (String)",function(){var e=["value1","value2","value7"],t="value2";beforeEach(function(){$("#multi-select").multiSelect(),$("#multi-select").multiSelect("select",e),$("#multi-select").multiSelect("deselect",t)}),it("should select corresponding option",function(){expect(-1<$.inArray(t,select.val())).toBeFalsy()})}),describe("on click",function(){var e,t,l;beforeEach(function(){$("#multi-select").find("option").first().prop("selected",!0),$("#multi-select").multiSelect(),e=$(".ms-selection ul.ms-list li").first(),t=e.attr("id").replace("-selection",""),l=$(".ms-selection ul.ms-list li").first(),spyOnEvent(select,"change"),spyOnEvent(select,"focus"),e.trigger("click")}),it("should hide clicked item",function(){expect(e).toBe(":hidden")}),it("should show associated selectable item",function(){expect($("#"+t+"-selectable")).toBe(":visible")}),it("should remove the .ms-selected class to the corresponding selectable item",function(){expect(l.hasClass("ms-selected")).toBeFalsy()}),it("should deselect corresponding option",function(){expect(select.find('option[value="'+t+'"]')).not.toBeSelected()}),it("should trigger the original select change event",function(){expect("change").toHaveBeenTriggeredOn("#multi-select")}),afterEach(function(){select.multiSelect("deselect_all")})})})});