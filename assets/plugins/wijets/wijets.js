$.wijets=new function(){var i=this;this.actionDefinitions={},this.registerAction=function(a){i.actionDefinitions[a.handle]=a},$.fn.pushWidgetControls=function(){var a=$(this).closest("[data-widget]").find("[data-widget-controls]");if(console.log(a.data("currentControls"),$(this).data("actionDefinition").handle),a.data("currentControls")==$(this).data("actionDefinition").handle)return null;var t=$($(this).data("actionDefinition").controls);(a.data("currentControls",$(this).data("actionDefinition").handle),a.children().length)?((t=$($(this).data("actionDefinition").controls)).hide(),a.append(t),t.show(),a.parent().toggleClass("editbox-open"),t.siblings().hide()):(t.show(),a.append(t),a.slideDown(100,"linear",function(){a.parent().toggleClass("editbox-open")}));return t},$.fn.hideWidgetControls=function(a){var t=$(this).closest("[data-widget]").find("[data-widget-controls]");a?t.slideUp(100,"linear",function(){t.empty(),t.data("currentControls",""),t.parent().toggleClass("editbox-open")}):(t.empty(),t.hide(),t.data("currentControls",""),t.parent().toggleClass("editbox-open"))},$.fn.getWidgetState=function(a){var t=void 0,e=$($(this).data("parentWidget")).data("widgetParameters");return e&&(t=e.id?localStorage.getItem($($(this).data("parentWidget")).data("widgetId")+"."+a):e[a]),t},$.fn.setWidgetState=function(a,t){var e=$($(this).data("parentWidget")).data("widgetParameters");return!!e&&(!!e.id&&(localStorage.setItem($($(this).data("parentWidget")).data("widgetId")+"."+a,t),!0))},this.registerAction({handle:"collapse",html:'<span class="button-icon has-bg"><span class="material-icons">keyboard_arrow_up</span></span>',onClick:function(){"keyboard_arrow_down"==$(this).find("span.material-icons").text()?$(this).find("span.material-icons").text("keyboard_arrow_up"):$(this).find("span.material-icons").text("keyboard_arrow_down");var a=$(this).data("actionParameters");a.target||(a.target=".panel-body");var t=$(this).closest("[data-widget]").find(a.target).is(":visible");$(this).closest("[data-widget]").find(a.target).slideToggle(100,"linear",function(){$(this).closest("[data-widget]").toggleClass("panel-collapsed")}),$(this).setWidgetState("collapsed",t)},onInit:function(){var a=$(this).data("actionParameters");a.containerClass&&$(this).addClass(a.containerClass),"true"==$(this).getWidgetState("collapsed")&&(a.target||(a.target=".panel-body"),"keyboard_arrow_down"==$(this).find("span.material-icons").text()?$(this).find("span.material-icons").text("keyboard_arrow_up"):$(this).find("span.material-icons").text("keyboard_arrow_down"),$(this).closest("[data-widget]").find(a.target).hide(),$(this).closest("[data-widget]").addClass("panel-collapsed"))}}),this.registerAction({handle:"edit",html:'<span class="button-icon"><i class="fa fa-pencil"></i></span>',controls:'<input type="text" class="form-control">',onClick:function(){var t=$(this),a=t.pushWidgetControls();a?($(a).val(t.closest("[data-widget]").find("h2").html()),a.bind("keyup",function(a){t.closest("[data-widget]").find("h2").html($(this).val()),t.setWidgetState("headerTitle",$(this).val()),13==a.keyCode&&t.hideWidgetControls()})):t.hideWidgetControls(!0)},onInit:function(){var a=$(this).getWidgetState("headerTitle");a&&$(this).closest("[data-widget]").find("h2").html(a)}}),this.registerAction({handle:"colorpicker",html:'<span class="button-icon"><i class="fa fa-tint"></i></span>',controls:'<ul class="panel-color-list"><li><span data-style="panel-info"></span></li><li><span data-style="panel-primary"></span></li><li><span data-style="panel-blue"></span></li><li><span data-style="panel-indigo"></span></li><li><span data-style="panel-deeppurple"></span></li><li><span data-style="panel-purple"></span></li><li><span data-style="panel-pink"></span></li><li><span data-style="panel-danger"></span></li><li><span data-style="panel-teal"></span></li><li><span data-style="panel-green"></span></li><li><span data-style="panel-success"></span></li><li><span data-style="panel-lime"></span></li><li><span data-style="panel-yellow"></span></li><li><span data-style="panel-warning"></span></li><li><span data-style="panel-orange"></span></li><li><span data-style="panel-deeporange"></span></li><li><span data-style="panel-midnightblue"></span></li><li><span data-style="panel-bluegray"></span></li><li><span data-style="panel-bluegraylight"></span></li><li><span data-style="panel-black"></span></li><li><span data-style="panel-gray"></span></li><li><span data-style="panel-default"></span></li><li><span data-style="panel-white"></span></li><li><span data-style="panel-brown"></span></li></ul>',onClick:function(){var t=$(this),a=t.pushWidgetControls();a?a.find("li span").bind("click",function(a){t.closest("[data-widget]").removeClass("panel-default panel-inverse panel-bluegray panel-bluegraylight panel-black panel-white panel-gray panel-yellow panel-deeporange panel-lime panel-success panel-pink panel-deeppurple panel-green panel-info panel-teal panel-primary panel-midnightblue panel-warning panel-orange panel-danger panel-brown panel-magenta panel-purple panel-indigo panel-blue").addClass($(this).attr("data-style")),$(t).setWidgetState("headerStyle",$(this).attr("data-style"))}):t.hideWidgetControls(!0)},onInit:function(){var a=$(this).getWidgetState("headerStyle");a&&$(this).closest("[data-widget]").removeClass("panel-default panel-inverse panel-bluegray panel-bluegraylight panel-black panel-white panel-gray panel-yellow panel-deeporange panel-lime panel-success panel-pink panel-deeppurple panel-green panel-info panel-teal panel-primary panel-midnightblue panel-warning panel-orange panel-danger panel-brown panel-magenta panel-purple panel-indigo panel-blue").addClass(a)}}),this.registerAction({handle:"expand",html:'<span class="button-icon has-bg"><i class="fa fa-expand"></i></span>',onClick:function(){bootbox.alert("Coming Soon at Avalon! Expand your panel to make it go fullscreen!")}}),this.registerAction({handle:"refresh",html:'<span class="button-icon"><i class="fa fa-repeat"></i></span>',onClick:function(){var a=$(this).data("actionParameters"),t=$(this).closest("[data-widget]");t.append('<div class="panel-loading"><div class="panel-loader-'+a.type+'"></div></div>'),t.find(".panel-body").load(a.url,function(){t.find(".panel-loading").remove()})}}),this.registerAction({handle:"separator",html:'<i class="separator">'}),this.registerAction({handle:"close",html:'<span class="button-icon"><i class="fa fa-times"></i></span>',onClick:function(){bootbox.alert("Coming Soon at Avalon!")}});return this.make=function(a){a=a||{};var t=function(a){for(var t={},e=[],n=0,i=a.length;n<i;++n)t.hasOwnProperty(a[n])||(e.push(a[n]),t[a[n]]=1);return e}($("[data-widget-group]").map(function(){return $(this).data("widget-group")}).get());$.each($("[data-widget]"),function(){var a=$(this).closest("[data-widget-group]").attr("data-widget-group");try{var t=$(this).attr("data-widget"),e=void 0;if(0<t.length&&(t=$.parseJSON(t),$(this).data("widgetParameters",t),t&&t.id&&(e=a+"."+t.id,$(this).data("widgetId",e)),"false"==t.draggable?$(this).attr("data-widget-static",""):$(this).removeAttr("data-widget-static"),t.id))for(var n in t)"id"!=n&&t.hasOwnProperty(n)&&null==localStorage.getItem(e+"."+n)&&(localStorage.setItem(e+"."+n,t[n]),console.log(e+"."+n,t[n]))}catch(a){console.log(a)}});for(var e=t.length-1;0<=e;e--)$('[data-widget-group="'+t[e]+'"]').sortable({connectWith:'[data-widget-group="'+t[e]+'"]',items:"[data-widget]:not([data-widget-static])",placeholder:"panel-placeholder",handle:a.handle?a.handle:".panel-heading",start:function(a,t){t.placeholder.height(t.helper.outerHeight()-4)}});$("[data-actions-container]").each(function(){var n=$(this),a=[];$.each(this.attributes,function(){a.push(this)}),$.browser.chrome||a.reverse(),$.each(a,function(){if("data-action-"==this.name.substr(0,12)){var a=this.name.substr(12);if(void 0!==i.actionDefinitions[a]){var t=$(i.actionDefinitions[a].html);n.append(t);try{var e=n.attr("data-action-"+a);0==e.length&&(e="{}"),t.data("actionParameters",$.parseJSON(e))}catch(a){console.log(a)}t.data("actionDefinition",i.actionDefinitions[a]),t.data("parentWidget",t.closest("[data-widget]")),i.actionDefinitions[a].onClick&&t.click(function(){i.actionDefinitions[a].onClick.call(this)}),i.actionDefinitions[a].onInit&&i.actionDefinitions[a].onInit.call(t)}}})})},this};